# Global Functional Requirements (FR)

This document defines the **functional requirements** for Cortex OS at the integration level. Each requirement is identified by a stable identifier (e.g. `FR-001`) and describes what the system **shall** do. These requirements are **sourced from the current frontend implementation** (Phase 0) and represent the features that the backend must support.

When the frontend or backend evolves, update this file and the corresponding traceability matrix.

## FR List

| ID | Requirement |
|----|-------------|
| **FR-001** | **Task management:** Users shall be able to create, view, update and delete tasks. Tasks have a title, optional description, status (`TODO`, `DOING`, `BLOCKED`, `DONE`, `ARCHIVED` — see ADR-0008), priority (`HIGH`, `MEDIUM`, `LOW`, `NONE`), optional due date, optional schedule window (`start_time`, `end_time`, optional `all_day`), optional planning windows (`plannedStartDate`, `plannedEndDate`, `baselineStartDate`, `baselineEndDate`, `actualStartDate`, `actualEndDate`), optional FS dependency links (`dependencies[]` with optional `lagDays`), optional project reference, optional linked note, optional assignee, area (work, health, home, personal, learning, finance), energy level (high, medium, low), tags, comments, and creation date. Tasks support recurring schedules and `blocked_by` dependency tracking. Tasks can be organized on a table/board workflow grouped or filtered by status and scheduling state. |
| **FR-002** | **Project management:** Users shall be able to manage projects with a title, optional description, status (`NOT_STARTED`, `ACTIVE`, `ON_HOLD`, `COMPLETED`, `ARCHIVED`), priority (`HIGH`, `MEDIUM`, `LOW`), date range, progress percentage (0-100), milestones, and AI-generated image artifacts. Projects may reference multiple tasks and can be created from templates (Software Project, Content Calendar, Blank). Milestones shall support a dual-write model: checklist items in markdown body linked by inline markers (`<!-- milestone:{id} -->`) to first-class milestone pages. On synchronization conflict, milestone-page state wins and rewrites body lines; deleting a markerized checklist line removes the linked milestone page. |
| **FR-003** | **Notes library:** Users shall be able to browse and view markdown notes in a vault-like file tree. Notes have an id, title, content, last modified date, tags, and a folder path. The file tree supports folders and files with expand/collapse navigation. |
| **FR-004** | **Today Dashboard:** The system shall provide a Today Dashboard showing today's schedule (time-blocked events and tasks), a task list with completion toggles and quick scheduling controls, a quick capture input, reflection/rollover assistance, and completion-rate progress metrics. |
| **FR-005** | **Command palette:** Users shall be able to open a command palette (`Ctrl/Cmd + K`) to search across notes, tasks, and projects. Results are categorized by type. Quick actions include task creation and navigation to any entity. |
| **FR-006** | **Feature toggles:** The application shall allow enabling or disabling domain modules (Travel, Finance, Workouts, Journal, Habits, Goals, Meals) via a settings screen. Disabled modules are hidden from navigation. |
| **FR-007** | **Project and note detail views:** When selecting a project, users shall view details including milestone/checklist state, an embedded task board filtered to that project, AI-generated artifacts, and a Timeline tab (Gantt) with zoom (`day|week|month|quarter`), dependency links, milestone markers, baseline overlays, and client-side critical-path highlighting. When selecting a note, users shall view its rendered content with an AI summary option in the context drawer. |
| **FR-008** | **Travel planner:** Users shall be able to manage trips as vault folders. Each trip has a destination, status (`Planning`, `Booked`, `Completed`), dates, budget, and cover image parsed from an `Overview.md` file. Trips contain child cards (markdown notes). Users can create new trips and add cards within a trip. |
| **FR-009** | **Personal finance:** Users shall be able to view budget summaries by month (with bar charts), view transaction history, manage manual accounts (Checking, Savings, Credit, Investment) with balances, and simulate CSV file imports. |
| **FR-010** | **Journal:** Users shall be able to write journal entries with date, content, mood (`Happy`, `Neutral`, `Sad`, `Stressed`, `Energetic`), and optional tags. Entries are displayed in reverse chronological order. |
| **FR-011** | **Habit tracking:** Users shall be able to define habits with daily or weekly frequency, track completion by date, maintain streak counts, and toggle completion for the current day. |
| **FR-012** | **Goal setting:** Users shall be able to set goals with a title, description, type (`MONTHLY`, `YEARLY`, `LONG_TERM`), progress percentage, target date, status (`IN_PROGRESS`, `COMPLETED`, `FAILED`), and optional link to a project. |
| **FR-013** | **Meal logging and recipes:** Users shall be able to record meals (Breakfast, Lunch, Dinner, Snack) with descriptions, optional recipe references, and calories. Recipes include title, ingredients list, instructions, calorie count, tags, and optional image. Macro-tracking extension (protein/carbs/fat/fiber) is proposed in ADR-0016. |
| **FR-014** | **AI integration:** Users shall be able to configure AI providers (Gemini, OpenAI, Claude, Ollama) with secure settings, select an active model from backend capabilities, and interact via a chat panel in the right drawer. The AI supports agent actions: creating tasks, creating goals, adding journal entries, and searching the user's data. AI features include note summarization, image generation, RAG query, and related-link suggestions. |
| **FR-015** | **Calendar workspace (Day/Week/Month):** The system shall provide calendar views for day, week, and month. Week view uses a 7-column day grid with hourly time slots. Month view supports continuous navigation/scrolling across months. Calendar items support types (event, task, reminder, deep-work), start/end times, optional location, and optional linked notes or tasks. Users can click to schedule tasks (modal flow), update, move, resize, and delete items subject to source permissions. Task-backed schedule blocks are first-class calendar items. |
| **FR-016** | **Theme switching:** Users shall be able to switch between dark and light modes. The UI applies theme via CSS custom properties. |
| **FR-017** | **Responsive navigation:** The application shall provide a collapsible left navigation bar (with icon-only collapsed mode), a top bar with search and AI access, and a right drawer for context-sensitive detail (note, task, project, or AI chat). |
| **FR-018** | **Keyboard shortcuts:** The system shall support `Ctrl/Cmd + K` for command palette and `Escape` to close modals and overlays. |
| **FR-019** | **Workout tracking:** Users shall be able to view workout history with name, date, exercise count, and duration. (Module is currently placeholder; full CRUD is planned.) |
| **FR-020** | **Local-first ownership:** The architecture is designed for local-first data ownership with Markdown vault files as the source of truth. In Phase 0, data is mocked in-memory. Backend implementation will persist data to encrypted local storage (SQLCipher) indexed from vault files. |
| **FR-021** | **PII Shield:** The system shall detect and redact PII before sending data to cloud AI providers and store secrets with encrypted-at-rest semantics (masked over IPC). |
| **FR-022** | **Morning Review (HITL):** Users shall be able to review and approve AI-generated content before it is written to the vault, including batch approve/reject flows and status filtering. |
| **FR-023** | **Unified search:** Users shall be able to search across all content. Phase 0 supports naive text matching. Backend will implement FTS5 (keyword) and sqlite-vec (semantic) search. |
| **FR-024** | **AI voice interaction:** Users shall be able to use voice input (speech-to-text) and receive spoken AI responses (text-to-speech). **Current implementation default:** STT uses an online provider (`gemini`) by default; local Whisper is deferred until native runtime/model lifecycle integration is completed. Optional STT providers include OpenAI and local Whisper (deferred path). TTS provider is configurable in Settings (Gemini, OpenAI, local Piper in Phase 5+). Voice settings include STT/TTS provider selection, provider-specific voice selection, and auto-speak toggle. The voice pipeline is chained (STT → any LLM → TTS) and provider-agnostic. See ADR-0013. |
| **FR-025** | **Quick Capture:** Users shall be able to quickly capture text thoughts that are appended to a daily capture file (`Quick Capture/{date}.md`). Available from the Today Dashboard. |
| **FR-026** | **Schedule management:** Users shall be able to view today's schedule as a timeline of time-blocked calendar events and tasks. Tasks are scheduled by setting `start_time`, `end_time`, and optional `all_day` properties; calendar queries merge `calendar_event.start/end` with task `start_time/end_time` to produce unified timeline/calendar rendering. See ADR-0007 (ScheduleItem → CalendarEvent convergence). |
| **FR-027** | **Google Calendar sync + editable mirrors:** Users shall be able to connect a Google account via OAuth, view calendar metadata (id/summary/color/primary), select synced calendars, and select an editable subset. Synced calendars load full history (past + future) with incremental updates thereafter. For editable calendars, Google events are mirrored into Cortex task-style workflow (with linked notes containing managed Google detail snapshots), and edits to core fields (title, description, location, start/end/all-day) write back to the original Google event. Delete on mirrored items removes both local mirror entities and the source Google event. Background sync supports immediate queueing after edits, periodic pull (5-minute cadence), and progress status telemetry. The calendar grid supports week/month view toggle with continuous-feeling month navigation. See ADR-0014. |
| **FR-028** | **Vault onboarding + secure preferences + incremental indexing:** On first run, users shall be able to create a new vault or select an existing vault. Cortex shall persist user settings/preferences per selected vault profile, store API keys/secrets encrypted at rest (keychain-backed key management), and trigger indexing only after successful save commits (with hash-based incremental reindex for changed content). See ADR-0015. |

### Notes

- FR-001 through FR-019 cover currently implemented features in the frontend (Phase 0).
- FR-020 through FR-023 describe architectural goals; partial Phase 0 implementations exist.
- FR-024 through FR-026 cover features implemented in Phase 0 frontend.
- FR-027 covers Google Calendar integration (ADR-0014). Editable selected-calendar mirror workflow and progress-aware background sync are in-scope.
- FR-028 covers Phase 4 vault onboarding and persistence/indexing semantics (ADR-0015).
- All FRs are sourced from the frontend implementation as the current source of truth for features. Backend and contracts must implement the IPC commands to support these requirements.
