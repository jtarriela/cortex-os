# Traceability Matrix

This document maps each functional requirement (FR) defined in `functional_requirements.md` to the repositories, files, and modules that implement it. Updating this matrix is part of the **Doc Sync Checklist** defined in `.system/DOC_SYNC_CHECKLIST.md`.

| FR ID | Repository & Location | Implementation Notes | Test Location (planned) |
|------|----------------------|----------------------|-------------------------|
| **FR-001** | **FE:** `types.ts` (Task, `TaskStatus` — `TODO\|DOING\|BLOCKED\|DONE\|ARCHIVED`, TaskPriority, Comment), `views/TasksIndex.tsx`, `components/CreateTaskModal.tsx`, `components/TaskDetailModal.tsx`, `services/dataService.ts` (getTasks, addTask, updateTask) | Kanban board grouped by status. **ADR-0008 (Phase 0.5):** BLOCKED status added; amber badge + select styling in TaskDetailModal + TasksIndex. In-memory CRUD in Phase 0. Backend will persist via `tasks.*` IPC commands. | `frontend/tests/dataService.smoke.test.ts` (BLOCKED type check ✅), `backend/tests/tasks.rs` |
| **FR-002** | **FE:** `types.ts` (Project, ProjectTemplate), `views/ProjectsIndex.tsx`, `views/ProjectDetail.tsx`, `services/dataService.ts` (getProjects, createProject, updateProject) | Gallery + detail views. Template-based creation. Milestones in-memory. Artifacts via AI image gen. | `frontend/tests/projects.spec.tsx`, `backend/tests/projects.rs` |
| **FR-003** | **FE:** `types.ts` (Note, FileNode), `views/NotesLibrary.tsx`, `services/dataService.ts` (getVaultRoot, getFileContent) | Two-panel file tree + note viewer. Mock `MOCK_FILE_SYSTEM` in constants.ts. | `frontend/tests/notes.spec.tsx`, `backend/tests/notes.rs` |
| **FR-004** | **FE:** `views/TodayDashboard.tsx`, `services/dataService.ts` (getTasks, getTodaySchedule, getHabits, saveQuickCapture) | Composite widget view. Queries tasks, schedule, habits. Quick capture appends to vault. | `frontend/tests/dashboard.spec.tsx`, `backend/tests/calendar.rs` |
| **FR-005** | **FE:** `components/CommandPalette.tsx`, `App.tsx` (keyboard handlers), `services/backend.ts` (`searchGlobal`, `searchSemantic`, `searchGraphNeighbors`), `stores/realtimeStore.ts` | Cmd+K opens palette. Command palette supports type filters, highlighted matches, preview snippets, and graph-neighbor badges; backend hybrid search and graph commands are wired. | `frontend/tests/command_palette.spec.tsx`, `frontend/tests/realtime_events.spec.ts` |
| **FR-006** | **FE:** `types.ts` (FeatureFlags), `stores/appStore.ts` (`features`), `App.tsx`, `components/LeftNav.tsx`, `views/Settings.tsx` | 7 toggleable modules. Default: Workouts OFF, rest ON. Feature flags now live in Zustand app store. | `frontend/tests/app_store.spec.ts` |
| **FR-007** | **FE:** `views/ProjectDetail.tsx` (milestones, embedded task board, artifacts), `components/RightDrawer.tsx` (note/project/task detail panels) | Project detail shows filtered task kanban + milestone checklist. Notes show AI summary in drawer. | `frontend/tests/detail_views.spec.tsx` |
| **FR-008** | **FE:** `types.ts` (Trip/TravelItinerary), `views/Travel.tsx`, `services/backend.ts` (`getTripsFromVault`, `createTripFolder`, `createTripCard`, `getTripItinerary`) | Vault-backed trips persist through backend IPC and itinerary cards are loaded via trip-level query (`travel_get_itinerary`). | `frontend/tests/backend.smoke.test.ts` (travel payload wiring), `backend/tests/trips.rs` |
| **FR-009** | **FE:** `types.ts` (Transaction, ManualAccount, YNABBudgetMonth, FinanceSummary), `views/Finance.tsx`, `services/backend.ts` (`getManualAccounts`, `addManualAccount`, `simulateCsvUpload`, `getFinanceSummary`) | Finance supports manual accounts, CSV persistence, budget charts, and month drill-down summary metrics. | `frontend/tests/backend.smoke.test.ts` (finance import/budget wiring), `backend/tests/finance.rs` |
| **FR-010** | **FE:** `types.ts` (JournalEntry, JournalMoodBucket), `views/Journal.tsx`, `services/backend.ts` (`queryJournalEntries`, `getJournalMoodTrends`, `addJournalEntry`). **ADR:** ADR-0003 | Reverse-chronological journal feed with backend date-range filtering and mood trend aggregation chart. | `frontend/tests/backend.smoke.test.ts`, `backend/tests/journal.rs` |
| **FR-011** | **FE:** `types.ts` (Habit, HabitSummary), `views/Habits.tsx`, `services/backend.ts` (`getHabits`, `addHabit`, `toggleHabit`, `getHabitSummary`) | Habit tracking persists completion history and supports streak/window analytics summaries. | `frontend/tests/backend.smoke.test.ts`, `backend/tests/habits.rs` |
| **FR-012** | **FE:** `types.ts` (Goal, GoalProgressSummary), `views/Goals.tsx`, `services/backend.ts` (`getGoals`, `addGoal`, `updateGoal`, `getGoalProgressSummary`). **ADR:** ADR-0001 | Goal cards include backend progress rollup metrics and project-link coverage for dashboard charts. | `frontend/tests/backend.smoke.test.ts`, `backend/tests/goals.rs` |
| **FR-013** | **FE:** `types.ts` (Meal, Recipe, MealsNutritionSummary), `views/Meals.tsx`, `services/backend.ts` (`getMeals`, `addMeal`, `updateMeal`, `deleteMeal`, `getRecipes`, `addRecipe`, `updateRecipe`, `deleteRecipe`, `getMealsNutritionSummary`). **ADR:** ADR-0002 | Weekly planner + recipe library with persisted CRUD and nutrition/recipe-link summary query support. | `frontend/tests/dataService.smoke.test.ts`, `backend/tests/meals.rs` |
| **FR-014** | **FE:** `views/Settings.tsx` (backend-driven model/provider capability UI + usage dashboard + Morning Review), `components/RightDrawer.tsx` (dynamic model list + stream error/retry/cancel UX), `services/backend.ts` (`ai_*`, `review_*`, `token_usage`, `ai_rag_query`, `ai_suggest_links`). **BE:** `crates/app/src/lib.rs` (`ai_chat` provider adapters + normalized stream events, `ai_rag_query`, `ai_suggest_links`). **ADR:** ADR-0004, ADR-0005 | **Phase 4 closure implementation:** AI command surface routes through backend adapters, frontend renders capability-gated controls, and RAG/suggest-link commands are contract-wired. | `frontend/tests/ai_service_migration.spec.ts`, `frontend/tests/backend_ai.spec.ts`, `backend/crates/app/src/ai.rs` (unit tests) |
| **FR-015** | **FE:** `types.ts` (CalendarEvent), `views/WeekDashboard.tsx`, `services/dataService.ts` (getWeekEvents, addCalendarEvent, updateCalendarEvent, deleteCalendarEvent) | 7-column week grid. Event types: event, task, deep-work, reminder. Drag interactions. | `frontend/tests/calendar.spec.tsx`, `backend/tests/calendar.rs` |
| **FR-016** | **FE:** `App.tsx` (theme useEffect), `views/Settings.tsx` | Adds/removes `light` class on `<html>`. CSS custom properties define palette. | `frontend/tests/theme.spec.tsx` |
| **FR-017** | **FE:** `components/LeftNav.tsx`, `components/TopBar.tsx`, `components/RightDrawer.tsx`, `App.tsx` (layout shell) | LeftNav collapsible (icon-only mode). TopBar inside content column. RightDrawer conditional overlay. | `frontend/tests/layout.spec.tsx` |
| **FR-018** | **FE:** `App.tsx` (global keydown handler) | Cmd+K toggles command palette. Escape closes command palette then CreateTaskModal. | `frontend/tests/keyboard.spec.tsx` |
| **FR-019** | **FE:** `types.ts` (Workout), `views/Workouts.tsx` (exists, not imported), `constants.ts` (MOCK_WORKOUTS), `services/dataService.ts` (getWorkouts) | Placeholder "Coming Soon" rendered inline in App.tsx. View file and mock data exist. Module default OFF in feature flags. | `frontend/tests/workouts.spec.tsx`, `backend/tests/workouts.rs` |
| **FR-020** | **Arch:** `docs/technical_architecture/001_architecture.md` | Phase 0 uses in-memory mocks. Architecture doc defines vault + SQLCipher + EAV model for local-first storage. | `backend/tests/vault.rs`, `backend/tests/storage.rs` |
| **FR-021** | **BE:** `crates/app/src/lib.rs` (`redact_pii`, `secret_store_*`, masked `settings_get/settings_update` behavior), `crates/storage/src/schema.rs` (`secret_store`, `usage_log`, `review_queue`), `contracts/docs/CONVENTIONS.md` (secret transport rules). | **Phase 4 closure implementation:** regex PII redaction is active for cloud routes and secrets are encrypted at rest with masked transport semantics. | `backend/crates/storage/tests/ai_phase4.rs`, `backend/crates/app/src/ai.rs` |
| **FR-022** | **BE:** `crates/storage/src/schema.rs` (`review_queue`), `crates/app/src/lib.rs` (`review_list`, `review_approve`, `review_reject`, AI write-intent queueing). **FE:** `views/Settings.tsx` Morning Review queue UI with edit/approve/reject and batch actions. | **Phase 4 closure implementation:** AI write intents require HITL review and frontend exposes full queue lifecycle states (pending/approved/rejected). | `backend/crates/storage/tests/ai_phase4.rs`, `frontend/tests/settings_integrations.spec.tsx` |
| **FR-023** | **BE:** `crates/app/src/search.rs` (chunking + sqlite-vec + wikilink graph + hybrid ranking), `crates/app/src/lib.rs` (`search_global`, `search_semantic`, `search_graph_neighbors`, `search_graph_suggest_links`). **FE:** `services/backend.ts` search APIs, `services/normalization.ts` (`normalizeSearchResult`), `components/CommandPalette.tsx` | Hybrid search now combines lexical and semantic ranking, adds preview and related-neighbor metadata, and exposes semantic/graph endpoints for UI and agent use. | `frontend/tests/command_palette.spec.tsx`, `backend/crates/app/src/search.rs` (unit tests) |
| **FR-024** | **FE:** `services/aiService.ts` + `components/RightDrawer.tsx` (voice input, auto-speak, stream controls). **BE:** `crates/app/src/lib.rs` (`ai_transcribe` tier-aware model selection, provider-routed `ai_synthesize`). **ADR:** ADR-0004, ADR-0013 | **Phase 4 closure implementation:** voice/STT/TTS entrypoints run through backend with tier/provider-aware routing and usage accounting. | `frontend/tests/ai_service_migration.spec.ts`, `frontend/tests/backend_ai.spec.ts` |
| **FR-025** | **FE:** `services/dataService.ts` (saveQuickCapture), `views/TodayDashboard.tsx` | Appends text to `Quick Capture/{date}.md` in mock filesystem. Accessible from Today Dashboard. | `frontend/tests/quick_capture.spec.tsx` |
| **FR-026** | **FE:** `types.ts` (CalendarEvent), `services/dataService.ts` (getTodaySchedule, addToSchedule), `views/TodayDashboard.tsx` | Time-blocked items with real `Date` start/end objects. **ADR-0007 (Phase 0.5):** `ScheduleItem` interface eliminated; `getTodaySchedule()` returns `CalendarEvent[]` sorted by start time; `addToSchedule()` constructs `Date` objects from HH:mm. `calendar.getToday` IPC command replaces deprecated `schedule.getToday`. | `frontend/tests/dataService.smoke.test.ts` (ADR-0007 CalendarEvent shape ✅), `backend/tests/calendar.rs` |
| **FR-027** | **BE:** `crates/integrations/google_calendar` (OAuth + list/create calendar + event insert/update/delete + incremental sync), `crates/app/src/lib.rs` (Integrations IPC sync routine). **FE:** `views/Settings.tsx` (auth/connect + calendar selection + sync trigger), `views/WeekDashboard.tsx` (event source badges + month toggle). **ADR:** ADR-0014 | **Phase 2 IMPLEMENTED** — `integrations_trigger_sync` now performs inbound incremental pull for selected calendars, outbound create/update/delete for Cortex-owned events, and timestamp-based conflict resolution (`page.updated_at` vs Google `event.updated`) using `cortex_page_id` correlation. Orphaned Cortex events are pruned from Google when the local page no longer exists. | `frontend/tests/calendar_sync.spec.ts`, `frontend/tests/settings_integrations.spec.tsx` |
| **FR-028** | **FE:** `App.tsx` (startup vault gate), `views/VaultSetup.tsx` (create/select onboarding), `stores/noteStore.ts` (dirty/debounce/flush save semantics), `services/backend.ts` (`vault_*`, `save_commit`, `index_queue_status`). **BE:** `crates/app/src/lib.rs` (`vault_create`, `vault_select`, `vault_get_profile`, `save_commit`, indexing queue + hash skip/coalesce), `crates/storage/src/schema.rs` (vault profile/index queue tables). **ADR:** ADR-0015 | **Phase 4 closure implementation:** first-run vault onboarding, secure settings transport, and save-commit incremental indexing semantics are wired end-to-end. | `frontend/tests/vault_setup.spec.tsx`, `frontend/tests/domain_stores.spec.ts`, `backend/crates/storage/tests/ai_phase4.rs`, `cargo test -p cortex-app` |

### How to read this matrix

- **FE:** = `cortex-os-frontend` repository
- **BE:** = `cortex-os-backend` repository (not yet implemented for most FRs)
- **Arch:** = Architecture design documents (implementation planned)
- **Test Location (planned):** Suggested test file paths. These tests do not exist yet.
- When adding or modifying a requirement, update this matrix and link the new code.

---

## Phase → FR Mapping

| Phase | Gate | FRs Addressed | GitHub Epic (cortex-os) |
|-------|------|---------------|------------------------|
| **0.5** Stabilization | Spike Gate (ADR-0011): 6 tech validations pass | FR-013 (Meals gap), FR-020 (local-first validation) | [#1](https://github.com/jtarriela/cortex-os/issues/1) |
| **1** Alpha Foundation | All views load from backend; data persists | FR-001–FR-019 (persistence), FR-020 (local-first), FR-023 (FTS5 search) | [#2](https://github.com/jtarriela/cortex-os/issues/2) |
| **2** Alpha Domains | Tasks + Calendar + Projects functional; Google Calendar integration includes bidirectional reconciliation | FR-001, FR-002, FR-003, FR-004, FR-015, FR-026, FR-027 | [#3](https://github.com/jtarriela/cortex-os/issues/3) |
| **3** Beta Foundation | Semantic search + Zustand + real-time updates | FR-005, FR-008–FR-013, FR-023 | [#4](https://github.com/jtarriela/cortex-os/issues/4) |
| **4** Beta AI+Privacy | AI via backend, PII shield, HITL, voice pipeline, vault onboarding/persistence hardening | FR-014, FR-021, FR-022, FR-024, FR-028 | [#5](https://github.com/jtarriela/cortex-os/issues/5) |

## Known Gaps

| Gap | FR | Issue | Status |
|-----|-----|-------|--------|
| Meals CRUD not in dataService.ts | FR-013 | FE [#1](https://github.com/jtarriela/cortex-os-frontend/issues/1) | **CLOSED Phase 0.5** — `getMeals`, `addMeal`, `updateMeal`, `deleteMeal`, `getRecipes`, `addRecipe`, `updateRecipe`, `deleteRecipe` extracted; `Meals.tsx` wired |
| BLOCKED task status missing | FR-001 | FE [#1](https://github.com/jtarriela/cortex-os-frontend/issues/1) | **CLOSED Phase 0.5** — `TaskStatus` updated; amber styling in `TaskDetailModal` + `TasksIndex` |
| ScheduleItem not converged to CalendarEvent | FR-015/FR-026 | FE [#1](https://github.com/jtarriela/cortex-os-frontend/issues/1) | **CLOSED Phase 0.5** — `ScheduleItem` removed; `getTodaySchedule()` returns `CalendarEvent[]` with real `Date` objects |
| No test files exist in frontend | All | FE [#1](https://github.com/jtarriela/cortex-os-frontend/issues/1) | **CLOSED Phase 0.5** — Vitest 3 + RTL infra added; 11 smoke tests green (`tests/dataService.smoke.test.ts`) |
| Backend 001_SCHEMA.md superseded by ADR-0006 | FR-020 | BE [#3](https://github.com/jtarriela/cortex-os-backend/issues/3) | Open — Phase 1 (file deprecated in-place; flat tables will not be implemented) |
| ADR-0011 Spike Gate: TipTap Markdown round-trip not yet validated | FR-003 | BE [#2](https://github.com/jtarriela/cortex-os-backend/issues/2) | **CLOSED Phase 2** — TipTap integrated with full markdown round-tripping for Notes and Tasks |
| Google Calendar sync still lacks full bidirectional reconciliation (outbound update/delete propagation + conflict handling) | FR-027 | BE [#6](https://github.com/jtarriela/cortex-os-backend/issues/6) | **CLOSED Phase 2** — trigger sync now performs inbound pull plus outbound create/update/delete with timestamp-based conflict handling and orphan cleanup |
