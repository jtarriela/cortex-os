# Traceability Matrix

This document maps each functional requirement (FR) defined in `functional_requirements.md` to the repositories, files, and modules that implement it. Updating this matrix is part of the **Doc Sync Checklist** defined in `.system/DOC_SYNC_CHECKLIST.md`.

| FR ID | Repository & Location | Implementation Notes | Test Location (planned) |
|------|----------------------|----------------------|-------------------------|
| **FR-001** | **FE:** `types.ts` (Task, `TaskStatus` — `TODO\|DOING\|BLOCKED\|DONE\|ARCHIVED`, TaskPriority, Comment), `views/TasksIndex.tsx`, `components/CreateTaskModal.tsx`, `components/TaskDetailModal.tsx`, `services/backend.ts` (addTask→`vault_create_page(kind:"task")`, getTasks→`collection_query`, updateTask→`page_update_props` + `page_update_body`). **BE:** `crates/app/src/lib.rs` (EAV generic commands). **ADR-0008:** BLOCKED status enforced. | Kanban board grouped by status. **Phase 2 IMPLEMENTED** — backend persists via EAV generic commands: `vault_create_page(kind:"task")`, `collection_query("tasks")`, `page_update_props`, `vault_delete`. Frontend IPC invoke argument casing is aligned to Tauri expectations (`collectionId`, `pageId`) to prevent command-arg validation failures. **Phase 5 bugfix (2026-02-20):** task-card markdown/title non-persistence resolved by sending `page_update_props` title as top-level command arg and persisting body via `page_update_body` during task updates. backend#6 closed. **ADR-0018 execution linkage:** external task-drop + interaction parity tracked by `cortex-os#24`, mixed editability constraints tracked by `cortex-os#25`. | `frontend/tests/dataService.smoke.test.ts` (BLOCKED type check ✅), `frontend/tests/backend.smoke.test.ts`, `backend/tests/tasks.rs` |
| **FR-002** | **FE:** `types.ts` (Project, ProjectTemplate), `views/ProjectsIndex.tsx`, `views/ProjectDetail.tsx`, `services/backend.ts` (createProject→`vault_create_page(kind:"project")`, getProjects→`collection_query`, updateProject→`page_update_props`, getProjectById→`vault_read`). **BE:** `crates/app/src/lib.rs` (EAV generic commands). | Gallery + detail views. Template-based creation. **Phase 2 IMPLEMENTED** — backend persists via `vault_create_page(kind:"project")`, `collection_query("projects")`, `page_update_props`, `vault_read`. Milestones/artifacts stored in `props` JSON. backend#6 closed. Reliability follow-up shipped in frontend PR [#37](https://github.com/jtarriela/cortex-os-frontend/pull/37): in-app project creation modal, filter diagnostics, and functional master-task controls on ProjectsIndex. | `frontend/tests/projects.spec.tsx`, `backend/tests/projects.rs` |
| **FR-003** | **FE:** `types.ts` (Note, FileNode), `views/NotesLibrary.tsx`, `services/dataService.ts` (getVaultRoot, getFileContent) | Two-panel file tree + note viewer. Mock `MOCK_FILE_SYSTEM` in constants.ts. | `frontend/tests/notes.spec.tsx`, `backend/tests/notes.rs` |
| **FR-004** | **FE:** `views/TodayDashboard.tsx`, `views/WeekDashboard.tsx`, `services/backend.ts` (getTodaySchedule→`calendar_get_today`, getWeekEvents→`calendar_get_week`, addCalendarEvent→`vault_create_page(kind:"calendar_event")`, updateCalendarEvent→`page_update_props`, deleteCalendarEvent→`vault_delete`, addToSchedule→`calendar_add_from_task`). **BE:** `crates/app/src/lib.rs` (`calendar_get_today`, `calendar_get_week`, `calendar_add_from_task` + EAV generic), `crates/storage/src/repo.rs` (reference-date week window query). | Composite widget view. **Phase 2 IMPLEMENTED** — calendar reads via `calendar_get_today`/`calendar_get_week`; mutations via EAV generic commands. Week view now queries by caller-provided reference date (instead of hardcoding current week) and surfaces load errors without blanking the entire screen. | `frontend/tests/backend.smoke.test.ts`, `backend/crates/storage/tests/repo_integration.rs` (`get_week_events_uses_reference_date_window`) |
| **FR-005** | **FE:** `components/CommandPalette.tsx`, `App.tsx` (keyboard handlers), `services/backend.ts` (`searchGlobal`, `searchSemantic`, `searchGraphNeighbors`), `stores/realtimeStore.ts` | Cmd+K opens palette. Command palette supports type filters, highlighted matches, preview snippets, and graph-neighbor badges; backend hybrid search and graph commands are wired. | `frontend/tests/command_palette.spec.tsx`, `frontend/tests/realtime_events.spec.ts` |
| **FR-006** | **FE:** `types.ts` (FeatureFlags), `stores/appStore.ts` (`features`), `App.tsx`, `components/LeftNav.tsx`, `views/Settings.tsx` | 7 toggleable modules. Default: Workouts OFF, rest ON. Feature flags now live in Zustand app store. | `frontend/tests/app_store.spec.ts` |
| **FR-007** | **FE:** `views/ProjectDetail.tsx` (milestones, embedded task board, artifacts), `components/RightDrawer.tsx` (note/project/task detail panels) | Project detail shows filtered task kanban + milestone checklist. Notes show AI summary in drawer. | `frontend/tests/detail_views.spec.tsx` |
| **FR-008** | **FE:** `types.ts` (Trip/TravelItinerary), `views/Travel.tsx`, `services/backend.ts` (`getTripsFromVault`, `createTripFolder`, `createTripCard`, `getTripItinerary`), `services/normalization.ts` (trip status normalization). **BE:** `crates/app/src/lib.rs` (`travel_create_trip`, `travel_create_card`). | Travel writes real markdown under `Travel/Trips/<slug>/` (`Overview.md` + card files), card creation uses collision-safe slugs, and Cards tab renders live `tripCards` with refresh-after-create so new cards appear immediately. Trip creation now uses a splash flow (destination + start date + duration + optional budget) so itinerary days are generated from trip metadata instead of stale hardcoded defaults. Travel view surfaces trip/card API errors (including command-arg mismatches) instead of failing silently. | `frontend/tests/backend.smoke.test.ts` (travel payload wiring), `backend/tests/trips.rs` |
| **FR-009** | **FE:** `types.ts` (Transaction, ManualAccount, YNABBudgetMonth, FinanceSummary), `views/Finance.tsx`, `services/backend.ts` (`getManualAccounts`, `addManualAccount`, `simulateCsvUpload`, `getFinanceSummary`) | Finance supports manual accounts, CSV persistence, budget charts, and month drill-down summary metrics. | `frontend/tests/backend.smoke.test.ts` (finance import/budget wiring), `backend/tests/finance.rs` |
| **FR-010** | **FE:** `types.ts` (JournalEntry, JournalMoodBucket), `views/Journal.tsx`, `services/backend.ts` (`queryJournalEntries`, `getJournalMoodTrends`, `addJournalEntry`). **ADR:** ADR-0003 | Reverse-chronological journal feed with backend date-range filtering and mood trend aggregation chart. | `frontend/tests/backend.smoke.test.ts`, `backend/tests/journal.rs` |
| **FR-011** | **FE:** `types.ts` (Habit, HabitSummary), `views/Habits.tsx`, `services/backend.ts` (`getHabits`, `addHabit`, `toggleHabit`, `getHabitSummary`) | Habit tracking persists completion history and supports streak/window analytics summaries. Habits UI now exits loading state deterministically and displays actionable error text when backend calls fail. | `frontend/tests/backend.smoke.test.ts`, `backend/tests/habits.rs` |
| **FR-012** | **FE:** `types.ts` (Goal, GoalProgressSummary), `views/Goals.tsx`, `services/backend.ts` (`getGoals`, `addGoal`, `updateGoal`, `getGoalProgressSummary`). **ADR:** ADR-0001 | Goal cards include backend progress rollup metrics and project-link coverage for dashboard charts. Goals view now surfaces backend create/query failures and uses a future default target date when creating new goals. | `frontend/tests/backend.smoke.test.ts`, `backend/tests/goals.rs` |
| **FR-013** | **FE:** `types.ts` (Meal, Recipe, MealsNutritionSummary), `views/Meals.tsx`, `services/backend.ts` (`getMeals`, `addMeal`, `updateMeal`, `deleteMeal`, `getRecipes`, `addRecipe`, `updateRecipe`, `deleteRecipe`, `getMealsNutritionSummary`). **ADR:** ADR-0002, ADR-0016 (planned extension) | Weekly planner + recipe library with persisted CRUD and nutrition/recipe-link summary query support. Meals includes in-view recipe creation from planner context, deterministic week-slot date matching, and inline backend error surfacing so recipe assignment is reliable without preloaded data. ADR-0016 defines a future macro-tracking extension path (protein/carbs/fat/fiber) on top of current calorie tracking. | `frontend/tests/dataService.smoke.test.ts`, `frontend/tests/backend.smoke.test.ts`, `backend/tests/meals.rs` |
| **FR-014** | **FE:** `views/Settings.tsx` (backend-driven model/provider capability UI + usage dashboard + Morning Review), `components/RightDrawer.tsx` (dynamic model list + stream error/retry/cancel UX), `services/backend.ts` (`ai_*`, `review_*`, `token_usage`, `ai_rag_query`, `ai_suggest_links`). **BE:** `crates/app/src/lib.rs` (`ai_chat` provider adapters + normalized stream events, `ai_rag_query`, `ai_suggest_links`). **ADR:** ADR-0004, ADR-0005 | **Phase 4 closure implementation:** AI command surface routes through backend adapters, frontend renders capability-gated controls, and RAG/suggest-link commands are contract-wired. | `frontend/tests/ai_service_migration.spec.ts`, `frontend/tests/backend_ai.spec.ts`, `backend/crates/app/src/ai.rs` (unit tests) |
| **FR-015** | **FE:** `types.ts` (CalendarEvent), `views/WeekDashboard.tsx`, `views/TodayDashboard.tsx`, `hooks/useWeekDashboard.ts` (`handleExternalDrop`, `handleDayflowEventUpdate`, `handleDayflowEventDelete`, `calendarItems` single-source-of-truth from `events`, `tasksRef`/`eventsRef` live refs), `hooks/useTodayDashboard.ts`, `services/backend.ts` (getWeekEvents, getTodaySchedule, addCalendarEvent, updateCalendarEvent, deleteCalendarEvent, `calendarScheduleTask`→`calendar_schedule_task`, `calendarRescheduleEvent`→`calendar_reschedule_event`), `utils/calendarDropIntent.ts` (timed/all-day intent mapping). **BE:** `crates/app/src/lib.rs` (`calendar_schedule_task`, `calendar_reschedule_event`, `integrations_trigger_sync` bounded processing guardrails), `crates/storage/src/repo.rs` (`reschedule_event` with read-only guard + indexed range/week query ordering). **ADR:** ADR-0018 (**ACCEPTED**, DayFlow + centralized calendar workspace). | Day/week/month calendar surfaces exist with drag/update/delete flows and explicit event draft-save behavior. **ADR-0018 E23/E24/E25/E26/E27 are delivered (2026-02-21)**: frontend added reproducible month-scroll/interaction/heap harness + DayFlow dependency/adapter guardrails (`test:dayflow-guardrails`); backend added calendar query/sync performance indexes + query-plan harness (`e27_performance.rs`) and bounded sync-run guardrails in `integrations_trigger_sync`; contracts added calendar compatibility governance checklists in VERSIONING/CODEGEN/WIRING docs. E27 merged via [frontend#47](https://github.com/jtarriela/cortex-os-frontend/pull/47), [backend#38](https://github.com/jtarriela/cortex-os-backend/pull/38), [contracts#22](https://github.com/jtarriela/cortex-os-contracts/pull/22). **E28-BugFix (2026-02-21):** two drag/drop bugs fixed — stale-closure reset wiping scheduled task times + silent sidebar drop crash. Scheduling path consolidated: `calendarScheduleTask`/`calendarRescheduleEvent` are now the authoritative IPC for all task→calendar scheduling; `calendarItems` is exclusively sourced from `events` returned by `calendar_get_range`; `handleExternalDrop` added to `useWeekDashboard` as a `DragEvent`-free entry point for sidebar drops. 15 tests in `useWeekDashboard.test.ts` (E28-BugFix in progress, PRs TBD). | `frontend/tests/hooks/useWeekDashboard.test.ts`, `frontend/tests/hooks/useTodayDashboard.test.ts`, `frontend/tests/calendar_sync.spec.ts`, `frontend/tests/hooks/useCalendarWorkspace.test.ts`, `frontend/tests/calendar/calendarDropIntent.spec.ts`, `frontend/tests/calendar/calendarPermissions.spec.ts`, `frontend/tests/perf/calendarMonthScroll.perf.test.ts`, `frontend/tests/contracts/dayflowDependencyPolicy.spec.ts`, `backend/crates/storage/tests/e24_drag_drop.rs`, `backend/crates/storage/tests/e25_permissions.rs`, `backend/crates/storage/tests/e27_performance.rs`, `backend/crates/app/src/lib.rs` (`enforce_sync_batch_limit_*`) |
| **FR-016** | **FE:** `App.tsx` (theme useEffect), `views/Settings.tsx` | Adds/removes `light` class on `<html>`. CSS custom properties define palette. | `frontend/tests/theme.spec.tsx` |
| **FR-017** | **FE:** `components/LeftNav.tsx`, `components/TopBar.tsx`, `components/RightDrawer.tsx`, `App.tsx` (layout shell) | LeftNav collapsible (icon-only mode). TopBar inside content column. RightDrawer conditional overlay. **ADR-0018 parity linkage:** responsive calendar-shell behavior tracked via `cortex-os#26` during DayFlow migration. | `frontend/tests/layout.spec.tsx` |
| **FR-018** | **FE:** `App.tsx` (global keydown handler), `utils/calendarKeyboard.ts` (`handleCalendarKeyDown` — Escape dismiss on DayFlow surface), `components/calendar/DayflowCalendarSurface.tsx` (`role="region"`, `aria-label`, `tabIndex`, `onKeyDown`, event slot `role="button"` + `aria-disabled`). **BE:** `@dayflow/plugin-keyboard-shortcuts` bootstrapped in E23. | Cmd+K toggles command palette. Escape closes command palette then CreateTaskModal. **ADR-0018 E26 delivered:** `handleCalendarKeyDown` utility handles Escape on calendar surface; `@dayflow/plugin-keyboard-shortcuts` handles all internal grid navigation (Enter/Space/Arrow/Delete routed through same IPC paths as pointer ops). Event slots are keyboard-accessible with `role="button"`, `aria-label`, and `aria-disabled` reflecting read-only state. | `frontend/tests/keyboard.spec.tsx`, `frontend/tests/calendar/dayflowCalendarSurface.spec.ts`, `frontend/tests/calendar/calendarKeyboard.spec.ts`, `frontend/tests/calendar/dayflowA11y.spec.tsx` |
| **FR-019** | **FE:** `types.ts` (Workout), `views/Workouts.tsx` (exists, not imported), `constants.ts` (MOCK_WORKOUTS), `services/dataService.ts` (getWorkouts) | Placeholder "Coming Soon" rendered inline in App.tsx. View file and mock data exist. Module default OFF in feature flags. | `frontend/tests/workouts.spec.tsx`, `backend/tests/workouts.rs` |
| **FR-020** | **Arch:** `docs/technical_architecture/001_architecture.md`. **BE:** `backend/crates/storage/src/schema.rs` (pages + EAV `props` JSON column, migrations V1–V3), `backend/crates/storage/src/repo.rs` (PageRepository). **ADR:** ADR-0006 (IMPLEMENTED) | Architecture defines local-first vault + SQLCipher + EAV model, and **Phase 5 verification** confirms implementation uses `pages(kind, props)` with no flat domain tables; `001_SCHEMA.md` is marked SUPERSEDED. | `backend/crates/storage/src/schema.rs` (`no_flat_domain_tables_exist`, `pages_has_eav_columns_kind_and_props`, `pages_table_exists_after_migration`) |
| **FR-021** | **BE:** `crates/app/src/lib.rs` (`redact_pii`, `secret_store_*`, masked `settings_get/settings_update` behavior), `crates/storage/src/schema.rs` (`secret_store`, `usage_log`, `review_queue`), `contracts/docs/CONVENTIONS.md` (secret transport rules). | **Phase 4 closure implementation:** regex PII redaction is active for cloud routes and secrets are encrypted at rest with masked transport semantics. | `backend/crates/storage/tests/ai_phase4.rs`, `backend/crates/app/src/ai.rs` |
| **FR-022** | **BE:** `crates/storage/src/schema.rs` (`review_queue`), `crates/app/src/lib.rs` (`review_list`, `review_approve`, `review_reject`, AI write-intent queueing). **FE:** `views/Settings.tsx` Morning Review queue UI with edit/approve/reject and batch actions. | **Phase 4 closure implementation:** AI write intents require HITL review and frontend exposes full queue lifecycle states (pending/approved/rejected). | `backend/crates/storage/tests/ai_phase4.rs`, `frontend/tests/settings_integrations.spec.tsx` |
| **FR-023** | **BE:** `crates/app/src/search.rs` (chunking + sqlite-vec + wikilink graph + hybrid ranking), `crates/app/src/lib.rs` (`search_global`, `search_semantic`, `search_graph_neighbors`, `search_graph_suggest_links`). **FE:** `services/backend.ts` search APIs, `services/normalization.ts` (`normalizeSearchResult`), `components/CommandPalette.tsx` | Hybrid search now combines lexical and semantic ranking, adds preview and related-neighbor metadata, and exposes semantic/graph endpoints for UI and agent use. | `frontend/tests/command_palette.spec.tsx`, `backend/crates/app/src/search.rs` (unit tests) |
| **FR-024** | **FE:** `views/Settings.tsx` (STT/TTS provider selectors + provider-specific voice list), `services/aiService.ts` + `components/RightDrawer.tsx` (voice input, auto-speak, stream controls). **BE:** `crates/app/src/ai.rs` (real OpenAI/Gemini STT/TTS adapters), `crates/app/src/lib.rs` (`ai_transcribe` routing by `sttProvider`, `ai_synthesize` routing by `ttsProvider`). **ADR:** ADR-0004, ADR-0013 | **Phase 5 update (local Whisper deferred):** voice pipeline remains provider-routed with `local_whisper/openai/gemini` STT and `gemini/openai/local` TTS settings, but current default STT is online (`gemini`). OpenAI/Gemini cloud adapters are live; local Whisper path remains deferred/deterministic until native runtime integration is completed. | `frontend/tests/ai_service_migration.spec.ts`, `frontend/tests/backend_ai.spec.ts`, `frontend/tests/settings_integrations.spec.tsx`, `backend/crates/app/src/ai.rs` (unit tests) |
| **FR-025** | **FE:** `services/backend.ts` (`saveQuickCapture` → `capture_save { text }`), `views/TodayDashboard.tsx`. **BE:** `crates/app/src/lib.rs` (`capture_save`). | Quick Capture now appends to real vault files at `Quick Capture/YYYY-MM-DD.md` and upserts the corresponding note page body/index state. Canonical IPC payload field is `text`. | `frontend/tests/backend.smoke.test.ts`, `frontend/tests/dataService.smoke.test.ts`, `frontend/tests/quick_capture.spec.tsx` |
| **FR-026** | **FE:** `types.ts` (CalendarEvent), `services/dataService.ts` (getTodaySchedule, addToSchedule), `views/TodayDashboard.tsx` | Time-blocked items with real `Date` start/end objects. **ADR-0007 (Phase 0.5):** `ScheduleItem` interface eliminated; `getTodaySchedule()` returns `CalendarEvent[]` sorted by start time; `addToSchedule()` constructs `Date` objects from HH:mm. `calendar.getToday` IPC command replaces deprecated `schedule.getToday`. | `frontend/tests/dataService.smoke.test.ts` (ADR-0007 CalendarEvent shape ✅), `backend/tests/calendar.rs` |
| **FR-027** | **BE:** `crates/integrations/google_calendar` (OAuth + list/create calendar + event insert/update/delete + incremental sync), `crates/app/src/lib.rs` (Integrations IPC sync routine, `calendar_reschedule_event` server-side read-only guard), `crates/storage/src/repo.rs` (`reschedule_event` enforces `props.read_only=true` → `InvalidArgument`). **FE:** `views/Settings.tsx` (auth/connect + calendar selection + sync trigger + surfaced integration errors), `views/WeekDashboard.tsx` (event source badges + month toggle), `components/calendar/DayflowCalendarSurface.tsx` (drag guard: checks `read_only` before initiating reschedule). **ADR:** ADR-0014 | **Phase 2 IMPLEMENTED + Phase 5 verified** — Core OAuth + sync confirmed present and compiles. Google OAuth requires `GOOGLE_CLIENT_ID` and `GOOGLE_CLIENT_SECRET`; frontend now surfaces missing-credential and sync/connect/list failures with actionable Settings errors. 6 backend smoke/unit tests cover OAuth/model parsing; FE integration tests cover error visibility. Gaps deferred: `disconnect_google`, `google_auth_status`, `set_calendar_color` → cortex-os-backend#26. **ADR-0018 E25 in review** (`cortex-os#25`): full per-event read-only enforcement across all mutation paths. Backend: `is_read_only_event`, `update_calendar_event_props` (guard), `delete_calendar_event` (guard), `calendar_event_is_editable` + `calendar_delete_event` IPC commands; 6 TDD tests in `e25_permissions.rs`. Frontend: `canEditEvent` / `canDeleteEvent` guards in all `useWeekDashboard` mutation paths; `deleteCalendarEvent` routes through guarded command; visual read-only state on events. Remaining gaps: `disconnect_google`, `google_auth_status`, `set_calendar_color` → cortex-os-backend#26. | `frontend/tests/calendar_sync.spec.ts`, `frontend/tests/settings_integrations.spec.tsx`, `frontend/tests/calendar/calendarPermissions.spec.ts`, `backend/crates/integrations/google_calendar/src/google/oauth.rs` (3 tests), `backend/crates/integrations/google_calendar/src/google/models.rs` (3 tests), `backend/crates/storage/tests/e25_permissions.rs` (6 tests) |
| **FR-028** | **FE:** `App.tsx` (startup vault gate), `views/VaultSetup.tsx` (create/select onboarding), `stores/noteStore.ts` (dirty/debounce/flush save semantics), `services/backend.ts` (`vault_*`, `save_commit`, `index_queue_status`). **BE:** `crates/app/src/lib.rs` (`vault_create`, `vault_select`, `vault_get_profile`, `vault_create_page`, `page_update_body`, `save_commit`, `vault_delete`, indexing queue + hash skip/coalesce), `crates/storage/src/schema.rs` (vault profile/index queue tables). **ADR:** ADR-0015 (IMPLEMENTED) | **Phase 4 closure + Phase 5 verified** — vault onboarding, secure settings, save-commit indexing, and markdown durability are confirmed. Core page mutations now persist/delete physical `.md` files in active vault root while keeping DB/index flow (`save_commit` hash dedup/coalesce). `App.tsx` gates on `vaultGetProfile`. ADR-0015 ACCEPTED→IMPLEMENTED (cortex-os#10). | `frontend/tests/vault_setup.spec.tsx` (3 tests), `frontend/tests/domain_stores.spec.ts`, `backend/crates/storage/tests/ai_phase4.rs` (`vault_profiles_*`, `index_queue_*`, `secret_store_*`) |

### How to read this matrix

- **FE:** = `cortex-os-frontend` repository
- **BE:** = `cortex-os-backend` repository (not yet implemented for most FRs)
- **Arch:** = Architecture design documents (implementation planned)
- **Test Location (planned):** Suggested test file paths. These tests do not exist yet.
- When adding or modifying a requirement, update this matrix and link the new code.

---

## Phase → FR Mapping

| Phase | Gate | FRs Addressed | GitHub Epic (cortex-os) |
|-------|------|---------------|------------------------|
| **0.5** Stabilization | Spike Gate (ADR-0011): 6 tech validations pass | FR-013 (Meals gap), FR-020 (local-first validation) | [#1](https://github.com/jtarriela/cortex-os/issues/1) |
| **1** Alpha Foundation | All views load from backend; data persists | FR-001–FR-019 (persistence), FR-020 (local-first), FR-023 (FTS5 search) | [#2](https://github.com/jtarriela/cortex-os/issues/2) |
| **2** Alpha Domains | Tasks + Calendar + Projects functional; Google Calendar integration includes bidirectional reconciliation | FR-001, FR-002, FR-003, FR-004, FR-015, FR-026, FR-027 | [#3](https://github.com/jtarriela/cortex-os/issues/3) |
| **3** Beta Foundation | Semantic search + Zustand + real-time updates | FR-005, FR-008–FR-013, FR-023 | [#4](https://github.com/jtarriela/cortex-os/issues/4) |
| **4** Beta AI+Privacy | AI via backend, PII shield, HITL, voice pipeline, vault onboarding/persistence hardening | FR-014, FR-021, FR-022, FR-024, FR-028 | [#5](https://github.com/jtarriela/cortex-os/issues/5) |

## ADR-0018 Delivery Traceability

| Epic (cortex-os) | Scope | FRs | Frontend Child | Backend Child | Contracts Child | Status | Evidence |
|------|------|------|------|------|------|------|------|
| [#23](https://github.com/jtarriela/cortex-os/issues/23) | CalendarWorkspace + DayFlow adapter foundation | FR-015, FR-026, FR-018 | [frontend#38](https://github.com/jtarriela/cortex-os-frontend/issues/38) | [backend#29](https://github.com/jtarriela/cortex-os-backend/issues/29) | [contracts#13](https://github.com/jtarriela/cortex-os-contracts/issues/13) | **Completed (2026-02-20)** | Implementation commits: frontend `9a213c5` (`tests/hooks/useCalendarWorkspace.test.ts`, `tests/calendar/dayflowAdapter.spec.ts`, `tests/calendar/dayflowCalendarSurface.spec.ts`), backend `cd91dd7` (`calendar_get_range` + `crates/storage/tests/repo_integration.rs` range coverage), contracts `75f50e2` (`docs/technical_planning/002_IPC_WIRING_MATRIX.md`, `CHANGELOG.md` 0.6.0`). Merged via PRs [frontend#43](https://github.com/jtarriela/cortex-os-frontend/pull/43), [backend#34](https://github.com/jtarriela/cortex-os-backend/pull/34), [contracts#18](https://github.com/jtarriela/cortex-os-contracts/pull/18); integration pins frontend `195e338`, backend `9a4b77b`, contracts `f28941b`. |
| [#24](https://github.com/jtarriela/cortex-os/issues/24) | External task drop + drag/resize parity | FR-001, FR-015, FR-026 | [frontend#39](https://github.com/jtarriela/cortex-os-frontend/issues/39) | [backend#30](https://github.com/jtarriela/cortex-os-backend/issues/30) | [contracts#14](https://github.com/jtarriela/cortex-os-contracts/issues/14) | **Completed (2026-02-20)** | frontend `f3a77f0` (`calendarDropIntent.ts`, `DayflowCalendarSurface` IPC wiring, `useDragDrop` copy semantics, 143 tests), backend `b44f5d2` (`calendar_schedule_task` + `calendar_reschedule_event` + read-only guard, 4 TDD tests), contracts `ccff18e` (`calendar.scheduleTask` + `calendar.rescheduleEvent` rows + intent-mapping table). PRs: [frontend#44](https://github.com/jtarriela/cortex-os-frontend/pull/44), [backend#35](https://github.com/jtarriela/cortex-os-backend/pull/35), [contracts#19](https://github.com/jtarriela/cortex-os-contracts/pull/19). |
| [#25](https://github.com/jtarriela/cortex-os/issues/25) | Mixed editability + Google permission enforcement | FR-027, FR-015, FR-001 | [frontend#40](https://github.com/jtarriela/cortex-os-frontend/issues/40) | [backend#31](https://github.com/jtarriela/cortex-os-backend/issues/31) | [contracts#15](https://github.com/jtarriela/cortex-os-contracts/issues/15) | **Completed (2026-02-20)** | frontend `bb6bee7` (PR [#45](https://github.com/jtarriela/cortex-os-frontend/pull/45)): `CalendarEvent.readOnly`, `calendarPermissions.ts`, pre-flight guards in all mutation paths, visual read-only state, 10 new tests (153 total). Backend `fcc04ae` (PR [#36](https://github.com/jtarriela/cortex-os-backend/pull/36)): `is_read_only_event`, `update_calendar_event_props`, `delete_calendar_event`, `calendar_event_is_editable` + `calendar_delete_event` IPC commands, 6 TDD tests. Contracts `fe66cbf` (PR [#20](https://github.com/jtarriela/cortex-os-contracts/pull/20)): permission policy table, `readOnly` field, error semantics. Integration PR [#30](https://github.com/jtarriela/cortex-os/pull/30) merged. |
| [#26](https://github.com/jtarriela/cortex-os/issues/26) | Accessibility/keyboard/responsive parity | FR-017, FR-018, FR-015 | [frontend#41](https://github.com/jtarriela/cortex-os-frontend/issues/41) | [backend#32](https://github.com/jtarriela/cortex-os-backend/issues/32) | [contracts#16](https://github.com/jtarriela/cortex-os-contracts/issues/16) | **Completed (2026-02-20)** | Merged PRs: [frontend#46](https://github.com/jtarriela/cortex-os-frontend/pull/46), [backend#37](https://github.com/jtarriela/cortex-os-backend/pull/37), [contracts#21](https://github.com/jtarriela/cortex-os-contracts/pull/21). Delivered `calendarKeyboard.ts` Escape handler, ARIA/keyboard semantics and responsive shell updates, and backend `start<end` interval guard coverage (`e26_interval.rs`). Integration pins: frontend `8484ba9`, backend `5803837`, contracts `cfccb47`. |
| [#27](https://github.com/jtarriela/cortex-os/issues/27) | Performance benchmark + upgrade governance | FR-015, FR-026 | [frontend#42](https://github.com/jtarriela/cortex-os-frontend/issues/42) | [backend#33](https://github.com/jtarriela/cortex-os-backend/issues/33) | [contracts#17](https://github.com/jtarriela/cortex-os-contracts/issues/17) | **Completed (2026-02-21)** | Merged PRs: [frontend#47](https://github.com/jtarriela/cortex-os-frontend/pull/47), [backend#38](https://github.com/jtarriela/cortex-os-backend/pull/38), [contracts#22](https://github.com/jtarriela/cortex-os-contracts/pull/22). Frontend delivered perf/compat/dependency guardrail suites (`calendarMonthScroll.perf`, adapter compatibility, dependency policy) and CI `test:dayflow-guardrails`; backend delivered migration V4 indexes, `e27_performance.rs` query-plan harness, and bounded sync guardrails/tests; contracts delivered VERSIONING/CODEGEN/WIRING governance checklist + changelog `0.6.1`. Integration pins: frontend `01e25af`, backend `10c714b`, contracts `821f2cc`. |
| — (E28-BugFix) | Frontend scheduling path consolidation + drag/drop bug fixes | FR-015, FR-001 | — | — | — | **In Progress (2026-02-21)** | Two drag/drop bugs fixed: (1) stale-closure reset — rescheduled tasks disappeared from calendar and reappeared as unscheduled; (2) silent sidebar drop crash — fake `DragEvent` without `preventDefault` caused a TypeError. Fixes: `tasksRef`/`eventsRef` live refs in `useWeekDashboard` make `handleDayflowEventUpdate` stable without stale closure; `handleExternalDrop` new function bypasses `DragEvent` API entirely; `calendarScheduleTask`/`calendarRescheduleEvent` IPC wired to `services/backend.ts`; `calendarItems` now sourced exclusively from `events` (single source of truth — `scheduledTasks` dual-path removed); `WeekDashboard.tsx` `onExternalDrop` calls `handleExternalDrop` directly. 15 frontend tests in `useWeekDashboard.test.ts` green (up from 10). No backend or contracts changes required (IPC commands already implemented in E24/E25). Contracts updated with [E28-BugFix] note in `002_IPC_WIRING_MATRIX.md`. |

## Known Gaps

| Gap | FR | Issue | Status |
|-----|-----|-------|--------|
| Meals CRUD not in dataService.ts | FR-013 | FE [#1](https://github.com/jtarriela/cortex-os-frontend/issues/1) | **CLOSED Phase 0.5** — `getMeals`, `addMeal`, `updateMeal`, `deleteMeal`, `getRecipes`, `addRecipe`, `updateRecipe`, `deleteRecipe` extracted; `Meals.tsx` wired |
| BLOCKED task status missing | FR-001 | FE [#1](https://github.com/jtarriela/cortex-os-frontend/issues/1) | **CLOSED Phase 0.5** — `TaskStatus` updated; amber styling in `TaskDetailModal` + `TasksIndex` |
| ScheduleItem not converged to CalendarEvent | FR-015/FR-026 | FE [#1](https://github.com/jtarriela/cortex-os-frontend/issues/1) | **CLOSED Phase 0.5** — `ScheduleItem` removed; `getTodaySchedule()` returns `CalendarEvent[]` with real `Date` objects |
| No test files exist in frontend | All | FE [#1](https://github.com/jtarriela/cortex-os-frontend/issues/1) | **CLOSED Phase 0.5** — Vitest 3 + RTL infra added; 11 smoke tests green (`tests/dataService.smoke.test.ts`) |
| Backend 001_SCHEMA.md superseded by ADR-0006 | FR-020 | BE [#3](https://github.com/jtarriela/cortex-os-backend/issues/3) | **CLOSED Phase 5** — `001_SCHEMA.md` has SUPERSEDED header; no flat domain tables implemented; EAV schema verified by `no_flat_domain_tables_exist` + `pages_has_eav_columns_kind_and_props` tests (cortex-os#11) |
| ADR-0011 Spike Gate: TipTap Markdown round-trip not yet validated | FR-003 | BE [#2](https://github.com/jtarriela/cortex-os-backend/issues/2) | **CLOSED Phase 2** — TipTap integrated with full markdown round-tripping for Notes and Tasks |
| Google Calendar sync still lacks full bidirectional reconciliation (outbound update/delete propagation + conflict handling) | FR-027 | BE [#6](https://github.com/jtarriela/cortex-os-backend/issues/6) | **CLOSED Phase 2** — trigger sync now performs inbound pull plus outbound create/update/delete with timestamp-based conflict handling and orphan cleanup |
| Task markdown/title edits in `TaskDetailModal` not persisting to task cards after reload | FR-001 | QA field report (2026-02-20) | **CLOSED Phase 5** — frontend `updateTask` now writes top-level `title` in `page_update_props` and commits markdown body via `page_update_body`; regression coverage added in `frontend/tests/backend.smoke.test.ts` |
| Dragging a scheduled task to a new time slot reset its `startTime`/`endTime` to undefined, causing it to disappear from the calendar and reappear as unscheduled | FR-015 | QA field report (2026-02-21) | **CLOSED E28-BugFix (2026-02-21)** — Root cause: stale closure in `handleDayflowEventUpdate` captured an outdated `tasks` array; else-branch called `updateCalendarEvent` (writes `start`/`end` props via EAV, not `start_time`/`end_time`) wiping task schedule on next `getTasks()`. Fix: `tasksRef`/`eventsRef` live refs + `calendarRescheduleEvent` IPC in `handleDayflowEventUpdate`; `calendarItems` now exclusively from `events` (removed `scheduledTasks` dual-path). |
| Dragging from the unscheduled tasks sidebar onto the DayFlow calendar surface did nothing (silent crash) | FR-015 | QA field report (2026-02-21) | **CLOSED E28-BugFix (2026-02-21)** — Root cause: `WeekDashboard.tsx` constructed a fake `DragEvent` without `preventDefault`; `useDragDrop.onDropHandler` called `event.preventDefault()` → TypeError. Fix: `handleExternalDrop` function added to `useWeekDashboard` bypasses `DragEvent` API entirely; `onExternalDrop` in `WeekDashboard.tsx` calls it directly. |
