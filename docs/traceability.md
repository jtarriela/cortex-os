# Traceability Matrix

This document maps each functional requirement (FR) defined in `functional_requirements.md` to the repositories, files, and modules that implement it. Updating this matrix is part of the **Doc Sync Checklist** defined in `.system/DOC_SYNC_CHECKLIST.md`.

| FR ID | Repository & Location | Implementation Notes | Test Evidence |
|------|----------------------|----------------------|-------------------------|
| **FR-001** | **FE:** `types.ts` (Task, `TaskStatus` — `TODO\|DOING\|BLOCKED\|DONE\|ARCHIVED`, TaskPriority, Comment, planning windows + `dependencies`), `views/TasksIndex.tsx` (status/schedule filters + context menu delete), `components/CreateTaskModal.tsx`, `components/TaskDetailModal.tsx`, `stores/taskStore.ts` (`createTask`, `updateTask`, `deleteTask` optimistic flows), `services/backend.ts` (addTask→`vault_create_page(kind:"task")`, getTasks→`collection_query`, updateTask→`page_update_props` + `page_update_body`, deleteTask→`vault_delete`). **BE:** `crates/app/src/lib.rs` (EAV generic commands). **ADR-0008:** BLOCKED status enforced. | Task management is fully EAV-backed and now exposed in both modal-edit and table/context-menu workflows. **Phase 6 update (2026-02-22):** planning fields (`planned*`, `baseline*`, `actual*`) and `FS + lagDays` dependency metadata were added to task normalization/persistence for timeline planning. | `frontend/tests/dataService.smoke.test.ts`, `frontend/tests/backend.smoke.test.ts`, `backend/crates/storage/tests/repo_integration.rs` (`create_and_get_roundtrip`, `update_props_changes_stored_data`) |
| **FR-002** | **FE:** `types.ts` (Project, `ProjectMilestone`, task planning/dependency types), `views/ProjectsIndex.tsx`, `views/ProjectDetail.tsx`, `hooks/useProjectsIndex.ts`, `hooks/useProjectTimeline.ts`, `components/projects/GanttChart.tsx`, `components/TipTapEditor.tsx`, `extensions/WikiLinkNode.ts`, `extensions/PageEmbedNode.ts`, `utils/slashCommands.ts`, `utils/projectMilestones.ts`, `services/backend.ts` (project CRUD + milestone CRUD via canonical commands), `services/normalization.ts` (`col_project_milestones`, planning + milestone mapping). **BE:** `crates/app/src/lib.rs` (EAV generic commands), `crates/core/src/lib.rs` (`col_project_milestones` kind map). **ADR:** ADR-0020, ADR-0021. | Gallery + detail views now include project/task context menus, master-board drag/drop persistence, and dual-write milestone synchronization (markerized checklist + milestone pages, page-wins conflict rule). Timeline tab delivers visx Gantt with zoom, dependency links, baseline overlays, and client-side critical-path recomputation. | `frontend/tests/editor.spec.tsx`, `frontend/tests/page_embed_node.spec.ts`, `frontend/tests/slash_commands.spec.ts`, `frontend/tests/hooks/useProjectsIndex.test.ts`, `frontend/tests/project_milestones.spec.ts`, `frontend/tests/hooks/useProjectTimeline.test.ts`, `frontend/tests/gantt_chart.spec.tsx`, `backend/crates/core/src/lib.rs` (`kind_for_known_collection`), `backend/crates/app/src/search.rs` (`graph_edges_refresh_after_wikilink_body_edit`) |
| **FR-003** | **FE:** `types.ts` (note `sourceHash` + linked mode fields + inspector types), `views/NotesLibrary.tsx` (tabbed Vault Workbench, split Cortex/Obsidian explorer sections, preview/source mode, keyboard shortcuts, conflict modal, wikilink preview navigation), `stores/noteStore.ts` (open-tab state, dirty-close guard, linked conflict state/resolution), `components/MarkdownCodeEditor.tsx` (CodeMirror markdown source editor + slash snippets), `components/VaultMarkdownPreview.tsx` (rendered markdown preview + clickable wikilinks/callouts + anchor scrolling), `components/RightDrawer.tsx` + `components/rightDrawer/NoteInspectorPanel.tsx` (note `Inspect` tab), `hooks/useNoteInspector.ts`, `utils/noteNavigation.ts`, `utils/vaultPreviewEvents.ts`, `services/backend.ts` (`saveLinkedNoteContent`, `saveLinkedNoteAsCortex`, `searchGraphLinks`, `obsidianNoteInspect`), `services/normalization.ts` (linked hash mapping). **BE:** `backend/crates/app/src/lib.rs` (linked mutation guard split + `obsidian_note_save`, `obsidian_note_inspect`, `search_graph_links` commands), `backend/crates/app/src/linked_vault.rs` (linked page mode/hash props + raw markdown handling), `backend/crates/storage/src/linked_vault.rs` (manifest/index-state lookups). **ADR:** ADR-0019, ADR-0022. | Notes now run as a preview-first Vault Workbench: users can open multiple markdown tabs, switch/close tabs safely, and explicitly enter source editing in CodeMirror when mode allows. Preview supports same-tab Obsidian wikilink navigation (best-effort heading/block anchors), split Cortex/Obsidian explorer sections, and note inspector diagnostics/backlinks. Read-only linked notes still surface Save-as-Cortex flow. | `frontend/tests/notes_library.spec.tsx`, `frontend/tests/vault_markdown_preview.spec.tsx`, `frontend/tests/note_navigation.spec.ts`, `frontend/tests/note_inspector.spec.tsx`, `frontend/tests/right_drawer.spec.tsx`, `frontend/tests/domain_stores.spec.ts`, `frontend/tests/hooks/useSettingsController.test.ts`, `backend/crates/app/src/lib.rs` (`obsidian_note_save_internal_*`, `obsidian_note_inspect_internal_*`), `backend/crates/app/src/search.rs` (`search_graph_links_returns_exact_directional_edges`) |
| **FR-004** | **FE:** `views/TodayDashboard.tsx`, `hooks/useTodayDashboard.ts`, `hooks/useCalendarWorkspace.ts`, `services/backend.ts` (getTodaySchedule→`calendar_get_today`, addToSchedule→`calendar_add_from_task`, updateTask→`page_update_props` + `page_update_body`). **BE:** `crates/app/src/lib.rs` (`calendar_get_today`, `calendar_add_from_task`), `crates/storage/src/repo.rs` (`get_today_events` uses `COALESCE(start,start_time)` across `calendar_event` + `task`). | Today dashboard now combines a live now-marker schedule timeline, inline task completion toggles, and explicit scheduling controls while preserving quick capture/reflection workflows. Scheduled task blocks are rendered from task page time props and merged with calendar events in one timeline. | `frontend/tests/hooks/useTodayDashboard.test.ts`, `frontend/tests/backend.smoke.test.ts`, `backend/crates/storage/tests/repo_integration.rs` |
| **FR-005** | **FE:** `components/CommandPalette.tsx`, `App.tsx` (keyboard handlers), `services/backend.ts` (`searchGlobal`, `searchSemantic`, `searchGraphNeighbors`), `stores/realtimeStore.ts` | Cmd+K opens palette. Command palette supports type filters, highlighted matches, preview snippets, and graph-neighbor badges; backend hybrid search and graph commands are wired. | `frontend/tests/command_palette.spec.tsx`, `frontend/tests/realtime_events.spec.ts` |
| **FR-006** | **FE:** `types.ts` (FeatureFlags), `stores/appStore.ts` (`features`), `App.tsx`, `components/LeftNav.tsx`, `views/Settings.tsx` | 7 toggleable modules. Default: Workouts OFF, rest ON. Feature flags now live in Zustand app store. | `frontend/tests/app_store.spec.ts` |
| **FR-007** | **FE:** `views/ProjectDetail.tsx` (milestone dual-write sync, timeline tab, embedded task board, artifacts), `components/RightDrawer.tsx` (note/project/task detail panels + milestone summary sync), `hooks/useProjectTimeline.ts`, `components/projects/GanttChart.tsx`, `utils/projectMilestones.ts` | Project detail now renders milestone/progress from synced checklist + milestone pages with legacy fallback, and exposes a Timeline tab with dependency/baseline/critical-path visuals. Notes continue to support AI summary in drawer. | `frontend/tests/project_milestones.spec.ts`, `frontend/tests/hooks/useProjectTimeline.test.ts`, `frontend/tests/gantt_chart.spec.tsx`, `frontend/tests/project_detail_property_row.spec.tsx` |
| **FR-008** | **FE:** `types.ts` (Trip/TravelItinerary), `views/Travel.tsx`, `services/backend.ts` (`getTripsFromVault`, `createTripFolder`, `createTripCard`, `getTripItinerary`), `services/normalization.ts` (trip status normalization). **BE:** `crates/app/src/lib.rs` (`travel_create_trip`, `travel_create_card`). | Travel writes real markdown under `Travel/Trips/<slug>/` (`Overview.md` + card files), card creation uses collision-safe slugs, and Cards tab renders live `tripCards` with refresh-after-create so new cards appear immediately. Trip creation now uses a splash flow (destination + start date + duration + optional budget) so itinerary days are generated from trip metadata instead of stale hardcoded defaults. Travel view surfaces trip/card API errors (including command-arg mismatches) instead of failing silently. | `frontend/tests/backend.smoke.test.ts` (travel payload wiring), `backend/crates/storage/tests/repo_integration.rs` (`create_and_get_roundtrip`) |
| **FR-009** | **FE:** `types.ts` (Transaction, ManualAccount, YNABBudgetMonth, FinanceSummary), `views/Finance.tsx`, `hooks/useFinanceView.ts`, `components/charts/VisxLineChart.tsx`, `components/charts/VisxBarChart.tsx`, `services/backend.ts` (`getManualAccounts`, `addManualAccount`, `simulateCsvUpload`, `getFinanceSummary`) | Finance supports manual accounts, CSV persistence, budget charts, and month drill-down summary metrics. **Phase 6 update (2026-02-22):** Finance charts migrated to visx and fetch/state logic moved to `useFinanceView` (ADR-0017 compliance). | `frontend/tests/backend.smoke.test.ts` (finance import/budget wiring), `frontend/tests/hooks/useFinanceView.test.ts`, `frontend/tests/visx_migration.spec.ts`, `backend/crates/storage/tests/repo_integration.rs` |
| **FR-010** | **FE:** `types.ts` (JournalEntry, JournalMoodBucket), `views/Journal.tsx`, `hooks/useJournalView.ts`, `components/charts/VisxBarChart.tsx`, `services/backend.ts` (`queryJournalEntries`, `getJournalMoodTrends`, `addJournalEntry`). **ADR:** ADR-0003 | Reverse-chronological journal feed with backend date-range filtering and mood trend aggregation chart. **Phase 6 update (2026-02-22):** Journal charts migrated to visx and view logic extracted to `useJournalView` (ADR-0017 compliance). | `frontend/tests/backend.smoke.test.ts`, `frontend/tests/hooks/useJournalView.test.ts`, `frontend/tests/visx_migration.spec.ts`, `backend/crates/storage/tests/repo_integration.rs` |
| **FR-011** | **FE:** `types.ts` (Habit, HabitSummary), `views/Habits.tsx`, `hooks/useHabitsView.ts`, `components/charts/VisxHorizontalBarChart.tsx`, `services/backend.ts` (`getHabits`, `addHabit`, `toggleHabit`, `getHabitSummary`) | Habit tracking persists completion history and supports streak/window analytics summaries. Habits UI now exits loading state deterministically and displays actionable error text when backend calls fail. **Phase 6 update (2026-02-22):** habits summary visualization migrated to visx with controller extraction to `useHabitsView`. | `frontend/tests/backend.smoke.test.ts`, `frontend/tests/hooks/useHabitsView.test.ts`, `frontend/tests/visx_migration.spec.ts`, `backend/crates/storage/tests/repo_integration.rs` (`habit_toggle_adds_then_removes_date`) |
| **FR-012** | **FE:** `types.ts` (Goal, GoalProgressSummary), `views/Goals.tsx`, `hooks/useGoalsView.ts`, `components/charts/VisxBarChart.tsx`, `services/backend.ts` (`getGoals`, `addGoal`, `updateGoal`, `getGoalProgressSummary`). **ADR:** ADR-0001 | Goal cards include backend progress rollup metrics and project-link coverage for dashboard charts. Goals view now surfaces backend create/query failures and uses a future default target date when creating new goals. **Phase 6 update (2026-02-22):** goals charts migrated to visx with controller extraction to `useGoalsView`. | `frontend/tests/backend.smoke.test.ts`, `frontend/tests/hooks/useGoalsView.test.ts`, `frontend/tests/visx_migration.spec.ts`, `backend/crates/storage/tests/repo_integration.rs` |
| **FR-013** | **FE:** `types.ts` (Meal, Recipe, MealsNutritionSummary), `views/Meals.tsx`, `services/backend.ts` (`getMeals`, `addMeal`, `updateMeal`, `deleteMeal`, `getRecipes`, `addRecipe`, `updateRecipe`, `deleteRecipe`, `getMealsNutritionSummary`). **ADR:** ADR-0002, ADR-0016 (planned extension) | Weekly planner + recipe library with persisted CRUD and nutrition/recipe-link summary query support. Meals includes in-view recipe creation from planner context, deterministic week-slot date matching, and inline backend error surfacing so recipe assignment is reliable without preloaded data. ADR-0016 defines a future macro-tracking extension path (protein/carbs/fat/fiber) on top of current calorie tracking. | `frontend/tests/dataService.smoke.test.ts`, `frontend/tests/backend.smoke.test.ts`, `backend/crates/storage/tests/repo_integration.rs` |
| **FR-014** | **FE:** `views/Settings.tsx` (backend-driven model/provider capability UI + usage dashboard + Morning Review), `components/RightDrawer.tsx` (dynamic model list + stream error/retry/cancel UX + note `AI`/`Inspect` tabs), `components/rightDrawer/NoteInspectorPanel.tsx`, `hooks/useNoteInspector.ts`, `services/backend.ts` (`ai_*`, `review_*`, `token_usage`, `ai_rag_query`, `ai_suggest_links`, `search_graph_links`). **BE:** `crates/app/src/lib.rs` (`ai_chat` provider adapters + normalized stream events, `ai_rag_query`, `ai_suggest_links`, `search_graph_links`). **ADR:** ADR-0004, ADR-0005 | **Phase 4 closure implementation + note-context refinement:** AI command surface routes through backend adapters, frontend renders capability-gated controls, and note-context AI evidence/link suggestions can be loaded on-demand from the right drawer inspector without auto-opening the drawer on focus changes. | `frontend/tests/ai_service_migration.spec.ts`, `frontend/tests/backend_ai.spec.ts`, `frontend/tests/right_drawer.spec.tsx`, `frontend/tests/note_inspector.spec.tsx`, `backend/crates/app/src/ai.rs` (unit tests) |
| **FR-015** | **FE:** `types.ts` (CalendarEvent), `components/calendar/DayflowCalendarSurface.tsx` (toolbar `+` interception, native drop-intent fallback, DayFlow delta sync), `components/calendar/ScheduleTaskModal.tsx`, `views/WeekDashboard.tsx`, `views/TodayDashboard.tsx`, `hooks/useWeekDashboard.ts` (`createEventPrompt`, `handleScheduleNewTask`, `handleScheduleExistingTask`, task/event identity resolution, `tasksRef`/`eventsRef` stale-closure guard, `calendarItems` projection from `googleEvents + scheduledTaskItems`), `hooks/useCalendarWorkspace.ts`, `services/backend.ts` (`calendarScheduleTask`, `calendarRescheduleEvent`, `deleteCalendarEvent`). **BE:** `crates/app/src/lib.rs` (`calendar_schedule_task`, `calendar_add_from_task`, `calendar_reschedule_event`), `crates/storage/src/repo.rs` (`reschedule_event`, `delete_calendar_event`, range/week/today queries across task + calendar_event kinds). **Contracts:** `contracts/docs/technical_planning/002_IPC_WIRING_MATRIX.md` (calendar command semantics + E28 final state note). **ADR:** ADR-0018. | Day/week/month calendar surfaces are delivered with modal-first scheduling UX and task-as-schedule persistence semantics. **Branch delta vs `main` (2026-02-21):** unscheduled sidebar drag scheduling was removed from Week view; scheduling entrypoints are header `Schedule` and DayFlow `+` (intercepted) into `ScheduleTaskModal`. Existing-task schedule path uses `updateTask` + `calendar_schedule_task`; new-task schedule path creates a task with `start_time/end_time` and refreshes range events. Backend retrieval (`calendar_get_today/week/range`) now merges `calendar_event.start` with `task.start_time` for unified calendar projection. | `frontend/tests/hooks/useWeekDashboard.test.ts`, `frontend/tests/hooks/useTodayDashboard.test.ts`, `frontend/tests/hooks/useCalendarWorkspace.test.ts`, `frontend/tests/calendar/calendarDropIntent.spec.ts`, `frontend/tests/perf/calendarMonthScroll.perf.test.ts`, `frontend/tests/contracts/dayflowDependencyPolicy.spec.ts`, `backend/crates/storage/tests/e24_drag_drop.rs`, `backend/crates/storage/tests/e25_permissions.rs`, `backend/crates/storage/tests/e27_performance.rs` |
| **FR-016** | **FE:** `App.tsx` (theme useEffect), `views/Settings.tsx` | Adds/removes `light` class on `<html>`. CSS custom properties define palette. | `frontend/tests/theme.spec.tsx` |
| **FR-017** | **FE:** `components/LeftNav.tsx`, `utils/navPreferences.ts`, `components/TopBar.tsx`, `components/RightDrawer.tsx`, `App.tsx`, `stores/appStore.ts` (layout shell + drawer focus semantics) | LeftNav collapsible (icon-only mode) and now defaults collapsed with locally persisted module reordering. TopBar remains inside content column. RightDrawer is manual-open and now provides note-context `Inspect` / `AI` tabs when focused on a note. **ADR-0018 parity linkage:** responsive calendar-shell behavior tracked via `cortex-os#26` during DayFlow migration. | `frontend/tests/layout.spec.tsx`, `frontend/tests/left_nav.spec.tsx`, `frontend/tests/app_store.spec.ts`, `frontend/tests/right_drawer.spec.tsx` |
| **FR-018** | **FE:** `App.tsx` (global keydown handler), `utils/calendarKeyboard.ts` (`handleCalendarKeyDown` — Escape dismiss on DayFlow surface), `components/calendar/DayflowCalendarSurface.tsx` (`role="region"`, `aria-label`, `tabIndex`, `onKeyDown`, event slot `role="button"` + `aria-disabled`). **BE:** `@dayflow/plugin-keyboard-shortcuts` bootstrapped in E23. | Cmd+K toggles command palette. Escape closes command palette then CreateTaskModal. **ADR-0018 E26 delivered:** `handleCalendarKeyDown` utility handles Escape on calendar surface; `@dayflow/plugin-keyboard-shortcuts` handles all internal grid navigation (Enter/Space/Arrow/Delete routed through same IPC paths as pointer ops). Event slots are keyboard-accessible with `role="button"`, `aria-label`, and `aria-disabled` reflecting read-only state. | `frontend/tests/keyboard.spec.tsx`, `frontend/tests/calendar/dayflowCalendarSurface.spec.ts`, `frontend/tests/calendar/calendarKeyboard.spec.ts`, `frontend/tests/calendar/dayflowA11y.spec.tsx` |
| **FR-019** | **FE:** `types.ts` (Workout), `views/Workouts.tsx` (exists, not imported), `constants.ts` (MOCK_WORKOUTS), `services/dataService.ts` (getWorkouts) | Placeholder "Coming Soon" rendered inline in App.tsx. View file and mock data exist. Module default OFF in feature flags. | `frontend/tests/workouts.spec.tsx` (backend module is still placeholder; no dedicated backend test file yet) |
| **FR-020** | **Arch:** `docs/technical_architecture/001_architecture.md`. **BE:** `backend/crates/storage/src/schema.rs` (EAV pages + migrations V1–V5), `backend/crates/storage/src/linked_vault.rs` (linked-vault metadata/state repository), `backend/crates/storage/src/repo.rs` (PageRepository). **ADR:** ADR-0006 (IMPLEMENTED), ADR-0019 (IMPLEMENTED). | Local-first SQLCipher model includes linked external-vault metadata/state tables (`vault_link`, `vault_file_manifest`, `vault_file_index_state`, `sync_queue`, `sync_runs`) without introducing flat domain tables. | `backend/crates/storage/src/schema.rs` (`no_flat_domain_tables_exist`, `linked_vault_tables_exist_after_migration_v5`), `backend/crates/storage/src/linked_vault.rs` (link/queue/run tests) |
| **FR-021** | **BE:** `crates/app/src/lib.rs` (`redact_pii`, `secret_store_*`, masked `settings_get/settings_update` behavior), `crates/storage/src/schema.rs` (`secret_store`, `usage_log`, `review_queue`), `contracts/docs/CONVENTIONS.md` (secret transport rules). | **Phase 4 closure implementation:** regex PII redaction is active for cloud routes and secrets are encrypted at rest with masked transport semantics. | `backend/crates/storage/tests/ai_phase4.rs`, `backend/crates/app/src/ai.rs` |
| **FR-022** | **BE:** `crates/storage/src/schema.rs` (`review_queue`), `crates/app/src/lib.rs` (`review_list`, `review_approve`, `review_reject`, AI write-intent queueing). **FE:** `views/Settings.tsx` Morning Review queue UI with edit/approve/reject and batch actions. | **Phase 4 closure implementation:** AI write intents require HITL review and frontend exposes full queue lifecycle states (pending/approved/rejected). | `backend/crates/storage/tests/ai_phase4.rs`, `frontend/tests/settings_integrations.spec.tsx` |
| **FR-023** | **BE:** `backend/crates/app/src/search.rs` (chunking + sqlite-vec + wikilink graph + hybrid ranking), `backend/crates/app/src/lib.rs` (`search_*`, `ai_rag_query`), `backend/crates/app/src/linked_vault.rs` (ADR-0019 ingest + reindex path). **FE:** `services/backend.ts` search/RAG APIs, `services/normalization.ts` (`normalizeSearchResult`), `components/CommandPalette.tsx`. | Hybrid search remains DB-index driven; ADR-0019 linked-vault ingestion updates page/chunk/vector indexes while query-time retrieval stays filesystem-independent. | `frontend/tests/command_palette.spec.tsx`, `backend/crates/app/src/search.rs` (`graph_edges_refresh_after_wikilink_body_edit`, `search_global_uses_db_index_without_source_file`) |
| **FR-024** | **FE:** `views/Settings.tsx` (STT/TTS provider selectors + provider-specific voice list), `services/aiService.ts` + `components/RightDrawer.tsx` (voice input, auto-speak, stream controls). **BE:** `crates/app/src/ai.rs` (real OpenAI/Gemini STT/TTS adapters), `crates/app/src/lib.rs` (`ai_transcribe` routing by `sttProvider`, `ai_synthesize` routing by `ttsProvider`). **ADR:** ADR-0004, ADR-0013 | **Phase 5 update (local Whisper deferred):** voice pipeline remains provider-routed with `local_whisper/openai/gemini` STT and `gemini/openai/local` TTS settings, but current default STT is online (`gemini`). OpenAI/Gemini cloud adapters are live; local Whisper path remains deferred/deterministic until native runtime integration is completed. | `frontend/tests/ai_service_migration.spec.ts`, `frontend/tests/backend_ai.spec.ts`, `frontend/tests/settings_integrations.spec.tsx`, `backend/crates/app/src/ai.rs` (unit tests) |
| **FR-025** | **FE:** `services/backend.ts` (`saveQuickCapture` → `capture_save { text }`), `views/TodayDashboard.tsx`. **BE:** `crates/app/src/lib.rs` (`capture_save`). | Quick Capture now appends to real vault files at `Quick Capture/YYYY-MM-DD.md` and upserts the corresponding note page body/index state. Canonical IPC payload field is `text`. | `frontend/tests/backend.smoke.test.ts`, `frontend/tests/dataService.smoke.test.ts`, `frontend/tests/quick_capture.spec.tsx` |
| **FR-026** | **FE:** `types.ts` (CalendarEvent), `services/backend.ts` (`getTodaySchedule`, `getCalendarRangeEvents`, `addToSchedule`, `calendarScheduleTask`), `services/normalization.ts` (`normalizeCalendarEventDTO` handles `task.start_time/end_time`), `hooks/useTodayDashboard.ts`, `hooks/useWeekDashboard.ts`. **BE:** `crates/app/src/lib.rs` (`calendar_get_today`, `calendar_get_week`, `calendar_get_range`, `calendar_schedule_task`, `calendar_add_from_task`), `crates/storage/src/repo.rs` (`get_today_events`, `get_week_events`, `get_events_in_range` over `COALESCE(start,start_time)`). | Schedule convergence is maintained: time-blocked items are returned as `CalendarEvent[]`, but task scheduling is now persisted directly on task pages (`start_time`/`end_time`) and merged with calendar events for timeline/week/month rendering. | `frontend/tests/dataService.smoke.test.ts`, `frontend/tests/hooks/useTodayDashboard.test.ts`, `frontend/tests/hooks/useWeekDashboard.test.ts`, `backend/crates/storage/tests/repo_integration.rs` |
| **FR-027** | **BE:** `crates/integrations/google_calendar/src/google/models.rs` (rich event metadata + all-day payload support), `crates/integrations/google_calendar/src/google/client.rs` (calendar metadata + all-day date/dateTime request handling), `crates/app/src/lib.rs` (`integrations_google_calendars` metadata response, full-history sync path, editable-calendar mirror upsert, `integrations_delete_mirrored_event`, `integrations_sync_progress` emission). **FE:** `views/Settings.tsx` (synced vs editable calendar selection by id + sync status), `hooks/useCalendarSyncQueue.ts` (single-flight queue, 5-minute polling, progress listener), `hooks/useWeekDashboard.ts` (task-style save fallback + mirrored delete path + enqueue sync), `hooks/useCalendarWorkspace.ts` (month prefetch range), `services/backend.ts` (new integration command mappings). **ADR:** ADR-0014, ADR-0018 | **Phase 6 update (2026-02-22)** — Google integration now supports calendar metadata-based selection, editable selected-calendar mirrors with writeback to source events, mirrored delete semantics, and progress-aware background sync telemetry. Month navigation uses prefetch-expanded range loading for seamless transitions. | `frontend/tests/hooks/useWeekDashboard.test.ts`, `frontend/tests/hooks/useCalendarWorkspace.test.ts`, `frontend/tests/settings_integrations.spec.tsx`, `frontend/tests/calendar_sync.spec.ts`, `frontend/tests/calendar/dayflowCalendarSync.spec.ts`, `backend/crates/integrations/google_calendar/src/google/models.rs` (4 tests), `backend/crates/storage/src/settings.rs` (integration settings roundtrip), `backend/crates/app/src/lib.rs` (unit tests) |
| **FR-028** | **FE:** `App.tsx` (startup vault gate), `views/VaultSetup.tsx`, `hooks/useSettingsController.ts` + `views/Settings.tsx` (linked-vault root + mode controls with `read_write` default), `services/backend.ts` (`vault_*`, `obsidian_*`, settings roundtrip). **BE:** `backend/crates/app/src/lib.rs` (`vault_*`, `obsidian_link_*`, mode validation), `backend/crates/app/src/linked_vault.rs` (link mode propagation into linked page `read_only` props), `backend/crates/storage/src/settings.rs` (`AISettings.embedding_provider`). **ADR:** ADR-0015 (IMPLEMENTED), ADR-0019 (IMPLEMENTED), ADR-0022 (IMPLEMENTED). | Vault onboarding/persistence behavior remains stable, while linked-vault settings now expose explicit `read_only` vs `read_write` policy and per-link mode updates in the vault context. | `frontend/tests/vault_setup.spec.tsx`, `frontend/tests/hooks/useSettingsController.test.ts`, `frontend/tests/settings_integrations.spec.tsx`, `backend/crates/app/src/lib.rs` tests |
| **FR-029** | **Contracts:** `contracts/docs/technical_planning/002_IPC_WIRING_MATRIX.md` (`obsidian.noteSave`, `obsidian.noteInspect`, `search.graphLinks`, `VaultLink.mode` enum expansion), `contracts/CHANGELOG.md` (`0.8.0`, `0.9.0`). **BE:** `backend/crates/app/src/lib.rs` (`obsidian_note_save`, `obsidian_note_inspect`, conflict payload, path safety + mode guards, `search_graph_links`), `backend/crates/app/src/linked_vault.rs` (raw markdown ingest, `source_hash`, mode-aware linked props), `backend/crates/storage/src/linked_vault.rs` (manifest/index lookup helpers). **FE:** `frontend/views/NotesLibrary.tsx` (preview-first linked workflows + conflict modal actions), `frontend/stores/noteStore.ts` (save conflict state + overwrite/use-server handlers), `frontend/services/backend.ts` (`saveLinkedNoteContent`, `obsidianNoteInspect`, `searchGraphLinks`), `frontend/components/MarkdownCodeEditor.tsx` (source-first editing), `frontend/components/VaultMarkdownPreview.tsx`, `frontend/components/rightDrawer/NoteInspectorPanel.tsx`. **ADR:** ADR-0022. | Linked Obsidian notes in `read_write` mode save back to source with optimistic concurrency (`base_hash`) and explicit conflict responses, while the note inspector surfaces linked source/index/sync diagnostics via dedicated IPCs. UI remains preview-first but requires explicit source-mode editing and explicit user conflict resolution (`use server` or `overwrite`) on mismatch; read-only mode still blocks linked write-back. | `backend/crates/app/src/lib.rs` (`obsidian_note_save_internal_saves_when_base_hash_matches`, `obsidian_note_save_internal_returns_conflict_when_hash_is_stale`, `obsidian_note_save_internal_round_trips_obsidian_markdown_source`, `obsidian_note_save_internal_rejects_read_only_mode`, `obsidian_note_save_internal_rejects_escaped_source_path`, `obsidian_note_inspect_internal_*`), `backend/crates/app/src/search.rs` (`search_graph_links_returns_exact_directional_edges`), `frontend/tests/domain_stores.spec.ts`, `frontend/tests/notes_library.spec.tsx`, `frontend/tests/vault_markdown_preview.spec.tsx`, `frontend/tests/note_inspector.spec.tsx` |

### How to read this matrix

- **FE:** = `cortex-os-frontend` repository
- **BE:** = `cortex-os-backend` repository
- **Arch:** = Architecture design documents (implementation planned)
- **Test Evidence:** Existing test files and/or explicit test targets used for verification.
- When adding or modifying a requirement, update this matrix and link the new code.

---

## Phase → FR Mapping

| Phase | Gate | FRs Addressed | GitHub Epic (cortex-os) |
|-------|------|---------------|------------------------|
| **0.5** Stabilization | Spike Gate (ADR-0011): 6 tech validations pass | FR-013 (Meals gap), FR-020 (local-first validation) | [#1](https://github.com/jtarriela/cortex-os/issues/1) |
| **1** Alpha Foundation | All views load from backend; data persists | FR-001–FR-019 (persistence), FR-020 (local-first), FR-023 (FTS5 search) | [#2](https://github.com/jtarriela/cortex-os/issues/2) |
| **2** Alpha Domains | Tasks + Calendar + Projects functional; Google Calendar integration includes bidirectional reconciliation | FR-001, FR-002, FR-003, FR-004, FR-015, FR-026, FR-027 | [#3](https://github.com/jtarriela/cortex-os/issues/3) |
| **3** Beta Foundation | Semantic search + Zustand + real-time updates | FR-005, FR-008–FR-013, FR-023 | [#4](https://github.com/jtarriela/cortex-os/issues/4) |
| **4** Beta AI+Privacy | AI via backend, PII shield, HITL, voice pipeline, vault onboarding/persistence hardening | FR-014, FR-021, FR-022, FR-024, FR-028 | [#5](https://github.com/jtarriela/cortex-os/issues/5) |

## ADR-0018 Delivery Traceability

| Epic (cortex-os) | Scope | FRs | Frontend Child | Backend Child | Contracts Child | Status | Evidence |
|------|------|------|------|------|------|------|------|
| [#23](https://github.com/jtarriela/cortex-os/issues/23) | CalendarWorkspace + DayFlow adapter foundation | FR-015, FR-026, FR-018 | [frontend#38](https://github.com/jtarriela/cortex-os-frontend/issues/38) | [backend#29](https://github.com/jtarriela/cortex-os-backend/issues/29) | [contracts#13](https://github.com/jtarriela/cortex-os-contracts/issues/13) | **Completed (2026-02-20)** | Implementation commits: frontend `9a213c5` (`tests/hooks/useCalendarWorkspace.test.ts`, `tests/calendar/dayflowAdapter.spec.ts`, `tests/calendar/dayflowCalendarSurface.spec.ts`), backend `cd91dd7` (`calendar_get_range` + `crates/storage/tests/repo_integration.rs` range coverage), contracts `75f50e2` (`docs/technical_planning/002_IPC_WIRING_MATRIX.md`, `CHANGELOG.md` 0.6.0`). Merged via PRs [frontend#43](https://github.com/jtarriela/cortex-os-frontend/pull/43), [backend#34](https://github.com/jtarriela/cortex-os-backend/pull/34), [contracts#18](https://github.com/jtarriela/cortex-os-contracts/pull/18); integration pins frontend `195e338`, backend `9a4b77b`, contracts `f28941b`. |
| [#24](https://github.com/jtarriela/cortex-os/issues/24) | External task drop + drag/resize parity | FR-001, FR-015, FR-026 | [frontend#39](https://github.com/jtarriela/cortex-os-frontend/issues/39) | [backend#30](https://github.com/jtarriela/cortex-os-backend/issues/30) | [contracts#14](https://github.com/jtarriela/cortex-os-contracts/issues/14) | **Completed (2026-02-20)** | frontend `f3a77f0` (`calendarDropIntent.ts`, `DayflowCalendarSurface` IPC wiring, `useDragDrop` copy semantics, 143 tests), backend `b44f5d2` (`calendar_schedule_task` + `calendar_reschedule_event` + read-only guard, 4 TDD tests), contracts `ccff18e` (`calendar.scheduleTask` + `calendar.rescheduleEvent` rows + intent-mapping table). PRs: [frontend#44](https://github.com/jtarriela/cortex-os-frontend/pull/44), [backend#35](https://github.com/jtarriela/cortex-os-backend/pull/35), [contracts#19](https://github.com/jtarriela/cortex-os-contracts/pull/19). |
| [#25](https://github.com/jtarriela/cortex-os/issues/25) | Mixed editability + Google permission enforcement | FR-027, FR-015, FR-001 | [frontend#40](https://github.com/jtarriela/cortex-os-frontend/issues/40) | [backend#31](https://github.com/jtarriela/cortex-os-backend/issues/31) | [contracts#15](https://github.com/jtarriela/cortex-os-contracts/issues/15) | **Completed (2026-02-20)** | frontend `bb6bee7` (PR [#45](https://github.com/jtarriela/cortex-os-frontend/pull/45)): `CalendarEvent.readOnly`, `calendarPermissions.ts`, pre-flight guards in all mutation paths, visual read-only state, 10 new tests (153 total). Backend `fcc04ae` (PR [#36](https://github.com/jtarriela/cortex-os-backend/pull/36)): `is_read_only_event`, `update_calendar_event_props`, `delete_calendar_event`, `calendar_event_is_editable` + `calendar_delete_event` IPC commands, 6 TDD tests. Contracts `fe66cbf` (PR [#20](https://github.com/jtarriela/cortex-os-contracts/pull/20)): permission policy table, `readOnly` field, error semantics. Integration PR [#30](https://github.com/jtarriela/cortex-os/pull/30) merged. |
| [#26](https://github.com/jtarriela/cortex-os/issues/26) | Accessibility/keyboard/responsive parity | FR-017, FR-018, FR-015 | [frontend#41](https://github.com/jtarriela/cortex-os-frontend/issues/41) | [backend#32](https://github.com/jtarriela/cortex-os-backend/issues/32) | [contracts#16](https://github.com/jtarriela/cortex-os-contracts/issues/16) | **Completed (2026-02-20)** | Merged PRs: [frontend#46](https://github.com/jtarriela/cortex-os-frontend/pull/46), [backend#37](https://github.com/jtarriela/cortex-os-backend/pull/37), [contracts#21](https://github.com/jtarriela/cortex-os-contracts/pull/21). Delivered `calendarKeyboard.ts` Escape handler, ARIA/keyboard semantics and responsive shell updates, and backend `start<end` interval guard coverage (`e26_interval.rs`). Integration pins: frontend `8484ba9`, backend `5803837`, contracts `cfccb47`. |
| [#27](https://github.com/jtarriela/cortex-os/issues/27) | Performance benchmark + upgrade governance | FR-015, FR-026 | [frontend#42](https://github.com/jtarriela/cortex-os-frontend/issues/42) | [backend#33](https://github.com/jtarriela/cortex-os-backend/issues/33) | [contracts#17](https://github.com/jtarriela/cortex-os-contracts/issues/17) | **Completed (2026-02-21)** | Merged PRs: [frontend#47](https://github.com/jtarriela/cortex-os-frontend/pull/47), [backend#38](https://github.com/jtarriela/cortex-os-backend/pull/38), [contracts#22](https://github.com/jtarriela/cortex-os-contracts/pull/22). Frontend delivered perf/compat/dependency guardrail suites (`calendarMonthScroll.perf`, adapter compatibility, dependency policy) and CI `test:dayflow-guardrails`; backend delivered migration V4 indexes, `e27_performance.rs` query-plan harness, and bounded sync guardrails/tests; contracts delivered VERSIONING/CODEGEN/WIRING governance checklist + changelog `0.6.1`. Integration pins: frontend `01e25af`, backend `10c714b`, contracts `821f2cc`. |
| — (`cal-patch`) | Task-as-schedule convergence + click-based scheduling UX | FR-015, FR-026, FR-001 | [frontend#48](https://github.com/jtarriela/cortex-os-frontend/pull/48) | [backend#39](https://github.com/jtarriela/cortex-os-backend/pull/39) | [contracts#23](https://github.com/jtarriela/cortex-os-contracts/pull/23) | **In Review (2026-02-21)** | Branch-level delta against `main`: Week view removed unscheduled drag sidebar and moved scheduling entry to `ScheduleTaskModal` (header button + DayFlow `+` interception). Frontend now projects calendar items as `googleEvents + scheduledTaskItems` and uses stale-safe refs in DayFlow callbacks. Backend now schedules/reschedules task pages directly (`start_time/end_time`) and range/week/today reads include both `calendar_event` and `task` pages via `COALESCE(start,start_time)`. Contracts wiring matrix updated to reflect the final E28 semantics. |

## Known Gaps

| Gap | FR | Issue | Status |
|-----|-----|-------|--------|
| Meals CRUD not in dataService.ts | FR-013 | FE [#1](https://github.com/jtarriela/cortex-os-frontend/issues/1) | **CLOSED Phase 0.5** — `getMeals`, `addMeal`, `updateMeal`, `deleteMeal`, `getRecipes`, `addRecipe`, `updateRecipe`, `deleteRecipe` extracted; `Meals.tsx` wired |
| BLOCKED task status missing | FR-001 | FE [#1](https://github.com/jtarriela/cortex-os-frontend/issues/1) | **CLOSED Phase 0.5** — `TaskStatus` updated; amber styling in `TaskDetailModal` + `TasksIndex` |
| ScheduleItem not converged to CalendarEvent | FR-015/FR-026 | FE [#1](https://github.com/jtarriela/cortex-os-frontend/issues/1) | **CLOSED Phase 0.5** — `ScheduleItem` removed; `getTodaySchedule()` returns `CalendarEvent[]` with real `Date` objects |
| No test files exist in frontend | All | FE [#1](https://github.com/jtarriela/cortex-os-frontend/issues/1) | **CLOSED Phase 0.5** — Vitest 3 + RTL infra added; 11 smoke tests green (`tests/dataService.smoke.test.ts`) |
| Backend 001_SCHEMA.md superseded by ADR-0006 | FR-020 | BE [#3](https://github.com/jtarriela/cortex-os-backend/issues/3) | **CLOSED Phase 5** — `001_SCHEMA.md` has SUPERSEDED header; no flat domain tables implemented; EAV schema verified by `no_flat_domain_tables_exist` + `pages_has_eav_columns_kind_and_props` tests (cortex-os#11) |
| ADR-0011 Spike Gate: TipTap Markdown round-trip not yet validated | FR-003 | BE [#2](https://github.com/jtarriela/cortex-os-backend/issues/2) | **CLOSED Phase 2** — TipTap integrated with full markdown round-tripping for Notes and Tasks |
| Google Calendar sync still lacks full bidirectional reconciliation (outbound update/delete propagation + conflict handling) | FR-027 | BE [#6](https://github.com/jtarriela/cortex-os-backend/issues/6) | **CLOSED Phase 2** — trigger sync now performs inbound pull plus outbound create/update/delete with timestamp-based conflict handling and orphan cleanup |
| Task markdown/title edits in `TaskDetailModal` not persisting to task cards after reload | FR-001 | QA field report (2026-02-20) | **CLOSED Phase 5** — frontend `updateTask` now writes top-level `title` in `page_update_props` and commits markdown body via `page_update_body`; regression coverage added in `frontend/tests/backend.smoke.test.ts` |
| Dragging a scheduled task to a new time slot reset its `startTime`/`endTime` to undefined, causing it to disappear from the calendar and reappear as unscheduled | FR-015 | QA field report (2026-02-21) | **CLOSED E28-BugFix (2026-02-21)** — Root cause: stale closure in `handleDayflowEventUpdate`. Fix: Path converged. `tasksRef`/`eventsRef` live refs + `calendarRescheduleEvent` IPC in `handleDayflowEventUpdate`. Native react drag-and-drop to calendar surface deprecated entirely in favor of click-to-book modal UX. |
| Dragging from the unscheduled tasks sidebar onto the DayFlow calendar surface did nothing (silent crash) | FR-015 | QA field report (2026-02-21) | **CLOSED E28-BugFix (2026-02-21)** — External drop UX deprecated. Unscheduled tasks sidebar removed. Users now click empty slots on the DayFlow surface to trigger `ScheduleTaskModal` which displays a quick-filter list of available tasks to schedule. |
