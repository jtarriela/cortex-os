
# MEMORY — Cortex OS (Integration)

## Current Focus
- **Atomic Habits (Habits module) ADR-0032 component PRs merged; integration pin/docs PR pending merge:** docs-first planning + accepted ADR are complete, and coordinated FE/BE/contracts changes now deliver dual-state habit completion (`STANDARD`/`MVH`), Weekly Review + look-forward planning, and habit-generated calendar block sync with linked calendar edit write-back. Component PRs merged: `cortex-os-contracts#27`, `cortex-os-backend#43`, `cortex-os-frontend#52` (frontend PR rebased once to resolve `services/backend.ts` merge conflict); integration pin/doc-sync PR remains to be merged.
- **ADR-0027 Stage 3 implemented and integration pin/closure sync completed:** component PRs `cortex-os-contracts#26`, `cortex-os-backend#42`, and `cortex-os-frontend#51` plus kickoff integration PR `cortex-os#36` are merged; follow-up integration closure issue `cortex-os#37` pins submodules to backend `3dd6347`, contracts `c3165fb`, frontend `34095bd`, syncs traceability/release log/MEMORY, and closes ADR-0027 as IMPLEMENTED.
- **Travel v2 staged planning docs + ADR set added:** integration plan `docs/integration/005_TRAVEL_MODULE_INTEGRATION_PLAN.md` and stage ADRs `ADR-0025` through `ADR-0031` are now in repo as the execution blueprint for structured travel (locations/items/expenses, routing/maps, import/Gmail, AI planner, calendar push).
- **Travel Stage 1/2 structured workspace implemented (initial slice):** backend/frontend/contracts now support `trip_location` / `trip_item` / `trip_expense`, workspace hydration, budget rollups, and legacy dual-read migration.
- **Travel Stage 1/2 integrity patch pass completed in workspace (pending/performing local merge pin):** cross-trip location validation, travel kind guards, title-only markdown sync, duplicate-safe legacy migration, deterministic create-trip selection, hybrid per-location item pathing for new files, `travel.moveItem clearLocation?` contract semantics, and `useTravelWorkspace` controller tests are implemented.
- **ADR-0024 finance mode/manual budgeting UX implemented:** Finance mode selection now lives in Settings → Life Modules (`MANUAL`/`YNAB`), YNAB PAT auth moved to Settings → Integrations, Finance redirects to Integrations when YNAB mode is selected without a token, and manual mode now includes a current-month budget template with minimal analysis.
- **ADR-0023 YNAB finance integration implemented:** Finance now supports YNAB PAT-backed view-only sync (full/delta), local `ynab_*` page caching, vault CSV mirror exports, tracked-category analyzer config, and whole-budget/tracked-category metrics surfaced in the Finance dashboard.
- **ADR-0020 closure + ADR-0021 implementation batch completed in workspace:** projects interaction parity (selection styling, context menus, master-board drag/drop, delete-unassign flow), dual-write milestone sync engine, timeline tab/Gantt delivery, and visx chart standardization across Finance/Goals/Habits/Journal/Today.
- **Calendar architecture consolidation accepted:** ADR-0018 is now ACCEPTED with execution epics `#23-#27` (adapter foundation, interaction parity, mixed editability, a11y/keyboard/responsive parity, performance/upgrade governance).
- **Phase 3 epic completion pass implemented (issue #4): search + state + secondary module persistence/analytics delivered across FE/BE/contracts.**
- **Phase 4 closure pass implemented (issue #5): vault onboarding, secure settings, save-commit indexing semantics, RAG commands, and frontend review/usage UX integrated.**
- **Phase 5 AI/Voice hardening implemented:** real OpenAI/Gemini STT/TTS adapters, provider-routed voice settings (`sttProvider`/`ttsProvider`), and contracts/docs sync for ADR-0004/0005/0013 (current STT default: online `gemini`; local Whisper deferred).
- **Phase 5 persistence/IPC alignment pass implemented:** `vault_create_page`/`capture_save` contract drift resolved, physical markdown writes added for page/travel/capture flows, Travel cards UI rewired to live state, and Google Settings now surfaces actionable integration errors.
- **Phase 5 runtime IPC casing stabilization pass in progress:** frontend invoke payloads are being standardized to Tauri command-argument camelCase (`collectionId`, `pageId`, `startDate`, etc.) with matching contracts documentation updates.
- **ADR-0019 implementation wave completed:** linked Obsidian vault sync/index/runtime and UI controls are delivered end-to-end.
- **ADR-0022 implementation wave completed:** Vault Workbench (tabbed source editor), linked `read_write` mode default, and explicit linked-note conflict resolution (`obsidian_note_save`) are merged across FE/BE/contracts with integration pins.

## System State (Facts Only)
- Integration repo acting as workspace root.
- Submodules: frontend, backend, contracts.
- Frontend: backend IPC is wired for core domains; app shell state now uses Zustand (`stores/appStore.ts`); realtime event subscription store (`stores/realtimeStore.ts`) invalidates active views on backend page events.
- Backend: Tauri app + SQLCipher storage + page repository implemented; Google OAuth + calendar list/create + incremental sync + outbound create/update/delete reconciliation are implemented; page mutation commands emit realtime events (`page_created`, `page_updated`, `page_deleted`).
- Contracts: IPC wiring matrix maintained in contracts repo; realtime event stream contract documented for Phase 3 foundation.
- Original architecture vision in `docs/technical_architecture/` (001–004). Frontend has diverged (domain-specific types instead of unified Page model; no Tauri yet; AI in frontend, not backend).

## Active ADRs

### Frontend-scoped (in `frontend/docs/frontend_architecture/000_OVERVIEW.md`)
- FE-AD-01: Global state in App.tsx useState (Zustand planned for Phase 3)
- FE-AD-02: In-memory mock service (backend wiring in Phase 1)
- FE-AD-03: Direct Gemini calls in frontend (moves to Rust backend in Phase 4)
- FE-AD-04: Domain-specific types, not "Page" model (backend normalizes internally)
- FE-AD-05: Feature flags for progressive module disclosure
- FE-AD-06: No router library (simple NavSection switch)

### Cross-cutting (in `docs/adrs/`)
- ADR-0001: Goals module — not in original vision, added in Phase 0 (ACCEPTED)
- ADR-0002: Meals/Recipes module — not in original vision, added in Phase 0 (ACCEPTED)
- ADR-0003: Journal with mood tracking — distinct from Notes/daily, added in Phase 0 (ACCEPTED)
- ADR-0004: AI multimodal features (Voice I/O + Image Gen) — not in original vision (ACCEPTED)
- ADR-0005: Frontend agent actions — direct tool-calling without HITL approval (ACCEPTED)
- ADR-0006: EAV/Page schema — canonical (supersedes backend 001_SCHEMA.md flat tables) (**IMPLEMENTED** — Phase 5 verification; no flat domain tables; CI-enforced by schema tests)
- ADR-0007: Schedule → Calendar convergence (ACCEPTED)
- ADR-0008: BLOCKED task status required (ACCEPTED)
- ADR-0009: Workouts module deferred to Phase 4 (ACCEPTED)
- ADR-0011: Spike Gate — 6 validations before Phase 1 (ACCEPTED)
- ADR-0012: Test strategy — TDD-first (ACCEPTED)
- ADR-0013: Voice/Audio architecture — local Whisper + configurable TTS (ACCEPTED)
- ADR-0015: Vault onboarding + secure settings + incremental reindex semantics (**IMPLEMENTED** — Phase 5 verified; vault_create/select/profile, save_commit, index_queue_status, secret_set/get/delete confirmed wired)
- ADR-0016: Meals macro-tracker extension roadmap (PROPOSED)
- ADR-0018: DayFlow calendar integration + centralized calendar workspace (ACCEPTED)
- ADR-0019: Obsidian linked vault by path + metadata-first sync + indexed RAG (**IMPLEMENTED** — linked-vault commands/UI are enabled by default; optional opt-out remains via feature controls)
- ADR-0020: Block editor for projects/tasks (TipTap custom extensions) (**IMPLEMENTED** — project/task/note editing + milestone/source-of-truth closure completed)
- ADR-0021: Full PM timeline (Gantt) + visx standardization (ACCEPTED)
- ADR-0022: Vault Workbench + linked Obsidian write-back (CodeMirror source-first) (IMPLEMENTED)
- ADR-0023: YNAB view-only finance dashboard (**IMPLEMENTED** — PAT sync, local `ynab_*` cache, CSV mirror, analyzer)
- ADR-0024: Finance mode selection + manual budgeting UI (**IMPLEMENTED** — Settings-driven mode + YNAB auth in Integrations + manual budget template)
- ADR-0025: Travel v2 Stage 1 — Foundation, RAG indexing parity, and legacy migration (PROPOSED)
- ADR-0026: Travel v2 Stage 2 — Itinerary, flights/lodging, budgeting (PROPOSED)
- ADR-0027: Travel v2 Stage 3 — Maps, routing, and Google export (**IMPLEMENTED** — Travel map tab + Google routing/export commands/caches + settings key integration delivered and integration pin synced)
- ADR-0028: Travel v2 Stage 4A — Web/text/screenshot import (PROPOSED)
- ADR-0029: Travel v2 Stage 4B — Gmail reservation scan (PROPOSED)
- ADR-0030: Travel v2 Stage 5 — AI copilot + optimization preview (PROPOSED)
- ADR-0031: Travel v2 Stage 6 — Calendar push + release hardening (PROPOSED)

## Roadmap — Issue Tracking

### Phase 0.5: Stabilization & Spike Gate (Pre-Alpha)
| Repo | Issue | Title |
|------|-------|-------|
| cortex-os | #1 | [Epic] Phase 0.5 — Spike Gate & Stabilization |
| cortex-os-backend | #1 | [Spike] Tauri v2 + SQLCipher + FTS5 + sqlite-vec |
| cortex-os-backend | #2 | [Spike] TipTap Markdown round-trip |
| cortex-os-frontend | #1 | [Epic] Phase 0.5 — Frontend Stabilization |
| cortex-os-contracts | #1 | [Epic] Phase 0.5 — Contracts Baseline |

### Phase 1: Alpha Foundation (Vault + Storage + IPC)
| Repo | Issue | Title |
|------|-------|-------|
| cortex-os | #2 | [Epic] Phase 1 — Alpha Foundation |
| cortex-os-backend | #3 | [Epic] Cargo Workspace + SQLCipher DB Layer |
| cortex-os-backend | #4 | [Epic] cortex_vault: Filesystem Adapter |
| cortex-os-backend | #5 | [Epic] Indexing Pipeline + Collection Engine |
| cortex-os-frontend | #2 | [Epic] IPC Migration (dataService → backend.ts) |
| cortex-os-contracts | #2 | [Epic] Page-Centric Command Specifications |

### Phase 2: Alpha (Domain Features + Planning)
| Repo | Issue | Title |
|------|-------|-------|
| cortex-os | #3 | [Epic] Phase 2 — Domain Features + Planning |
| cortex-os-backend | #6 | [Epic] Task Lifecycle + Calendar + Project Tracking |
| cortex-os-frontend | #3 | [Epic] TipTap Editor + Task Dependencies + Calendar |

### Phase 3: Beta Foundation (Search + State)
| Repo | Issue | Title |
|------|-------|-------|
| cortex-os | #4 | [Epic] Phase 3 — Search + State Management |
| cortex-os-backend | #7 | [Epic] Search Infrastructure + Graph + Secondary Modules |
| cortex-os-frontend | #4 | [Epic] Zustand Migration + Real-Time Events + Search |

### Phase 4: Beta (AI Backend + Privacy)
| Repo | Issue | Title |
|------|-------|-------|
| cortex-os | #5 | [Epic] Phase 4 — AI Backend + Privacy + Polish |
| cortex-os-backend | #8 | [Epic] cortex_ai: LLM Gateway + Voice + Privacy |
| cortex-os-frontend | #5 | [Epic] AI Frontend Migration + Streaming + Approval |
| cortex-os-contracts | #3 | [Epic] AI Command Specifications |

### Phase 5.1: Calendar Platform Integration (ADR-0018)
| Repo | Issue | Title |
|------|-------|-------|
| cortex-os | #23 | [Epic][ADR-0018] Calendar Workspace + DayFlow Adapter Foundation |
| cortex-os | #24 | [Epic][ADR-0018] Interaction Parity: External Task Drop + Drag/Resize |
| cortex-os | #25 | [Epic][ADR-0018] Mixed Editability + Google Permission Enforcement |
| cortex-os | #26 | [Epic][ADR-0018] Accessibility, Keyboard, and Responsive Parity |
| cortex-os | #27 | [Epic][ADR-0018] Performance Benchmarks + Upgrade Governance |
| cortex-os-frontend | #38 | [Child][ADR-0018][E23] Calendar Workspace + DayFlow Adapter Foundation (Frontend) |
| cortex-os-frontend | #39 | [Child][ADR-0018][E24] External Task Drop + Drag/Resize Parity (Frontend) |
| cortex-os-frontend | #40 | [Child][ADR-0018][E25] Mixed Editability + Google Permission UX (Frontend) |
| cortex-os-frontend | #41 | [Child][ADR-0018][E26] A11y + Keyboard + Responsive Parity (Frontend) |
| cortex-os-frontend | #42 | [Child][ADR-0018][E27] Performance Harness + DayFlow Upgrade Guardrails (Frontend) |
| cortex-os-backend | #29 | [Child][ADR-0018][E23] Calendar Range APIs + Workspace Support (Backend) |
| cortex-os-backend | #30 | [Child][ADR-0018][E24] Drag/Drop Persistence Semantics + Scheduling Paths (Backend) |
| cortex-os-backend | #31 | [Child][ADR-0018][E25] Permission Enforcement for Google-Sourced Events (Backend) |
| cortex-os-backend | #32 | [Child][ADR-0018][E26] Calendar IPC Stability for Keyboard/A11y Flows (Backend) |
| cortex-os-backend | #33 | [Child][ADR-0018][E27] Calendar Query/Sync Performance Baseline + Upgrade Safety (Backend) |
| cortex-os-contracts | #13 | [Child][ADR-0018][E23] Calendar Workspace Contract Baseline + Wiring Updates (Contracts) |
| cortex-os-contracts | #14 | [Child][ADR-0018][E24] External Drop/Drag Contract Clarifications (Contracts) |
| cortex-os-contracts | #15 | [Child][ADR-0018][E25] Mixed Editability Error Contract + Policy Mapping (Contracts) |
| cortex-os-contracts | #16 | [Child][ADR-0018][E26] Keyboard/A11y Interaction Contract + Drift Guard (Contracts) |
| cortex-os-contracts | #17 | [Child][ADR-0018][E27] Versioning + Compatibility Governance for Calendar Integration (Contracts) |

## Functional Requirements
- 29 FRs defined in `docs/functional_requirements.md` (FR-001 through FR-029)
- All sourced from frontend implementation
- FR-008 updated (2026-02-23) to reflect structured Travel Stage 1/2 workspace semantics (locations/items/expenses + legacy migration) in addition to legacy trip cards.
- FR-008 updated (2026-02-23, later same day) to include ADR-0027 Stage 3 maps/routing/export implementation surface, tests, and integration pin evidence.
- FR-020 complete in backend foundation. FR-021/FR-022 now have Phase 4 foundation implementation (PII redaction + review queue); further provider hardening remains.

## Recent Progress (Append-only)
- 2026-02-19: Documentation initialization.
- 2026-02-19: Init docs evaluated against frontend implementation; moved from `docs/init_docs/` → `docs/technical_architecture/` (001–004). Frontend has: Goals, Meals, Journal, AI voice/image gen, feature flags — not all in original init docs. Frontend lacks: Tauri IPC, vault filesystem, TipTap editor, Zustand, collection engine, SQLCipher.
- 2026-02-19: Created `frontend/docs/frontend_architecture/` (6 files: 000-005). Updated `docs/functional_requirements.md` (26 FRs). Updated `docs/traceability.md` (26 rows). Updated `backend/docs/backend_architecture/` (000, 001, 002). Updated `contracts/docs/technical_planning/002_IPC_WIRING_MATRIX.md`.
- 2026-02-19: Created ADR-0001 through ADR-0005 in `docs/adrs/`. Annotated `docs/technical_architecture/` (001–004) with Phase 0 Reality divergence sections. Updated traceability with ADR cross-references.
- 2026-02-19: Full codebase evaluation. Created development roadmap: Phase 0.5 → Phase 1 → Phase 2 → Phase 3 → Phase 4. Created 21 GitHub epic issues across all 4 repos with gates, FR mapping, ADR references. Created labels (phase:*, epic, spike, gate, tech-debt, doc-sync, paired-pr, adr) across all repos. Updated MEMORY.md with roadmap issue tracking. Key findings: backend is 0% implemented (docs only), frontend ~70% Phase 0, contracts docs complete but no artifacts.
- 2026-02-19: Phase 0.5 Spike Gate backend (BE #1) complete. Cargo workspace created: crates/app (Tauri v2), crates/core (Page stub), crates/storage (SQLCipher+FTS5+sqlite-vec). 6 tests pass (2 unit + 4 integration). Evidence in `backend/docs/testing_strategy/001_TEST_EVIDENCE.md`. Branch: `codex/issue-1-spike-tauri-sqlcipher-fts5-vec`. devcontainer + docker-compose added to integration repo.
- 2026-02-19: Phase 0.5 Frontend stabilization (FE #1) complete. Added BLOCKED status (ADR-0008), converged ScheduleItem→CalendarEvent (ADR-0007), extracted Meals CRUD to dataService.ts (FR-013), Vitest 3 + RTL test infra (11 smoke tests green). Branch: `codex/issue-1-phase-0.5-frontend-stabilization`.
- 2026-02-19: Phase 0.5 Contracts baseline (Contracts #1) complete. Updated IPC wiring matrix: BLOCKED enum, deprecated schedule.* commands, added calendar.getToday + meals.update/delete + recipes.update/delete, error response convention. Created CHANGELOG.md. Merged to main.
- 2026-02-19: Phase 0.5 TipTap spike (BE #2) complete. 15 tests green: gray-matter round-trips YAML frontmatter; tiptap-markdown 0.9.0 round-trips body (headings, bold/italic, code, lists, links) in jsdom. Strip-and-reattach pattern confirmed. Packages: tiptap-markdown ✅, gray-matter ✅, @tiptap/extension-link not needed. FE PR #7 merged. TEST_EVIDENCE.md updated in backend main.
- 2026-02-19: **Phase 0.5 COMPLETE.** All 6 ADR-0011 Spike Gate validations passed. All PRs merged. Phase 1 unblocked.
- 2026-02-19: Phase 2 FR-027 hardening pass complete in workspace. Backend added real `integrations_trigger_sync` flow with OAuth token refresh, calendar discovery, Cortex calendar creation, inbound incremental pull to local `calendar_event` pages, and outbound creation for `sync_external` events. Frontend integrations flow updated and lint blockers resolved; tests expanded for sync/Settings behavior. Submodule commits: backend `c6b17a7`, frontend `14b0426`.
- 2026-02-19: FR-027 reconciliation completed in backend workspace branch. `integrations_trigger_sync` now does outbound updates/deletes, applies timestamp conflict policy (`local updated_at` vs Google `updated`), and removes orphaned Cortex events in Google via `cortex_page_id` correlation.
- 2026-02-19: Phase 3 foundation increment implemented for epic #4/#7. Frontend migrated shell state to Zustand (`frontend/stores/appStore.ts`), added realtime Tauri event subscriptions (`frontend/stores/realtimeStore.ts`), and enhanced command palette filtering/highlighting/related badges (`frontend/components/CommandPalette.tsx`) with new tests. Backend emits page lifecycle events from mutation commands in `backend/crates/app/src/lib.rs`. Contracts wiring matrix updated with Event Streams section.
- 2026-02-19: Phase 3 epic completion pass (workspace #4/#7/#4). Frontend added domain Zustand stores (`taskStore`, `projectStore`, `noteStore`) with optimistic CRUD and reduced prop drilling in `TasksIndex`, `ProjectsIndex`, `NotesLibrary`, and task modals; secondary polish shipped (Journal mood trend chart + date-window query, Goals progress summary chart, Finance month drill-down, Travel itinerary card loading). Backend added search provider extension with optional Ollama embeddings (hash fallback), semantic/graph commands, and secondary analytics commands (`journal_query`, `journal_mood_trends`, `habits_get_summary`, `goals_get_progress_summary`, `finance_get_summary`, `travel_get_itinerary`, `meals_get_nutrition_summary`). Contracts/backend/frontend docs and traceability updated; frontend+backend test suites green.
- 2026-02-19: Phase 4 foundation slice implemented for epic #5/#8/#3. Backend added AI command surface (`ai_get_models`, `ai_chat`, `ai_summarize`, `ai_generate_image`, `ai_transcribe`, `ai_synthesize`, `ai_validate_key`, `review_list`, `review_approve`, `review_reject`, `token_usage`), regex-based PII redaction, streaming events (`ai_stream_chunk`, `ai_stream_done`), and SQLCipher migrations for `review_queue` + `usage_log`. Frontend migrated `services/aiService.ts` from frontend-direct Gemini SDK to backend IPC wrappers, wired streaming chunks into `RightDrawer`, and added Ollama endpoint configuration in `Settings`. New tests pass: `frontend/tests/backend_ai.spec.ts`, `frontend/tests/ai_service_migration.spec.ts`, `backend/crates/storage/tests/ai_phase4.rs`.
- 2026-02-19: Phase 4 closure implementation pass complete in workspace. Backend now includes vault onboarding (`vault_create`, `vault_select`, `vault_get_profile`), encrypted secret store (`secret_set/get/delete` + masked settings transport), save-commit indexing queue (`save_commit`, `index_queue_status` with hash skip/coalescing), provider-adapter AI routing with normalized `ai_stream_error`, and RAG commands (`ai_rag_query`, `ai_suggest_links`). Frontend now gates startup on vault profile (`views/VaultSetup.tsx`), uses dirty/debounced note save commits with flush semantics (`stores/noteStore.ts`), and ships Settings-side Morning Review + token usage dashboard + backend-driven model/provider capability controls. Contracts docs updated for 0.4.0 surface/changelog.
- 2026-02-19: **Phase 2 backend#6 closed (Task Lifecycle + Calendar + Project Tracking).** EAV generic commands satisfy all Phase 2 requirements — no domain-specific wrappers needed. Frontend calls `vault_create_page(kind:"task"|"project"|"calendar_event")`, `collection_query`, `page_update_props`, `vault_delete`, `calendar_get_today/week`, `calendar_add_from_task`. Contracts wiring matrix backend handler column updated. FR-001, FR-002, FR-004 marked Phase 2 IMPLEMENTED in traceability.
- 2026-02-19: **Phase 5 Google Calendar E2E verification complete (cortex-os#12).** ADR-0014 core confirmed: `crates/integrations/google_calendar` compiles, Settings Integrations tab present, OAuth loopback/CSRF/sync implemented. 6 new smoke tests (`google::oauth::tests::*`, `google::models::tests::*`). Gaps deferred to backend#26: `disconnect_google`, `google_auth_status`, `set_calendar_color`.
- 2026-02-19: **Phase 5 Vault Onboarding verification complete (cortex-os#10).** ADR-0015 IMPLEMENTED — vault_create/select/profile, save_commit, index_queue_status, secret_set/get/delete confirmed wired. VaultSetup.tsx + App.tsx startup gate + noteStore 1500ms debounce autosave confirmed. Tests: vault_setup.spec.tsx (3), domain_stores.spec.ts, ai_phase4.rs (3 vault/index/secret tests).
- 2026-02-19: **Phase 5 EAV verification complete (cortex-os#11).** ADR-0006 IMPLEMENTED — backend confirmed EAV-only (`pages` + `props` JSON column, no flat domain tables). Two schema CI-guard tests added (`no_flat_domain_tables_exist`, `pages_has_eav_columns_kind_and_props`). ADR-0006 updated with implementation notes (props-as-column vs props table deviation documented). Traceability FR-020 updated. All tests green.
- 2026-02-19: **Phase 5 gap audit complete.** Submodules initialized (were empty — root cause of broken UI). ADR gap analysis performed: all Phase 4 critical-path code confirmed present in component repo main branches (vault onboarding, VaultSetup.tsx, noteStore save-commit, secret encryption, index queue). 73 frontend tests + 18 backend storage tests all green. ADR-0011 status table retroactively updated to IMPLEMENTED (PR cortex-os#13). Phase 5 epics created: cortex-os#9 (spike gate), cortex-os#10 (vault onboarding), cortex-os#11 (EAV verification), cortex-os#12 (Google Calendar E2E). Open gaps deferred: Phase 2 issues (backend#6, frontend#3, contracts#2) still open; Google Calendar E2E (ADR-0014) unverified end-to-end. Submodule SHAs: backend `26f5f37`, frontend `1cb2041`, contracts `756fff1`.
- 2026-02-20: **Phase 5 Real AI Provider Adapters + Voice Pipeline completed (workspace pass).** Backend `cortex-app` routes `ai_transcribe` via `AISettings.stt_provider` (`local_whisper|openai|gemini`) and `ai_synthesize` via `AISettings.tts_provider` (`gemini|openai|local`) with real OpenAI/Gemini adapter transport in `crates/app/src/ai.rs`. **Follow-up policy update:** local Whisper runtime is deferred, and default STT is now online (`gemini`) until native runtime/model lifecycle implementation lands. Frontend `Settings` exposes STT/TTS provider selectors with provider-specific voice lists; backend/core `AISettings` includes provider fields. Contracts/docs updated (`002_IPC_WIRING_MATRIX.md`, `CONVENTIONS.md`, `CHANGELOG.md` 0.5.1). Verification: `cargo test -p cortex-app --lib`, `cargo test -p cortex-core`, `cargo test -p cortex-storage settings::tests::get_returns_default_when_missing`, `npm run lint`, and targeted Vitest AI/settings suites pass.
- 2026-02-20: **Integration pin sync after backend merge (`cortex-os-backend#28`).** `cortex-os` now tracks backend `4934ec1` on submodule `main` (voice provider adapters + routed STT/TTS). Release log updated in `docs/integration/002_RELEASE_PROCESS.md`; epic `cortex-os#14` closed.
- 2026-02-20: **Phase 5 card/file creation + Google UX reliability pass implemented (workspace).** Backend aligned IPC payload contracts (`vault_create_page` canonical `{ kind, props, body? }`, `capture_save` canonical `{ text }`), added markdown persistence for create/update/delete/save/travel/capture flows, and normalized travel status casing (`Planning|Booked|Completed`). Frontend rewired Travel Cards tab to live `tripCards` state and surfaced Google connect/list/sync credential/runtime failures in Settings with explicit `GOOGLE_CLIENT_ID`/`GOOGLE_CLIENT_SECRET` guidance. Contracts matrix and traceability docs updated for payload/side-effect alignment.
- 2026-02-20: **Integration pin sync after card/file + Google reliability merges.** `cortex-os` now tracks backend `c8fa5c6`, frontend `8f6493f`, contracts `9912069` on submodule `main`. Release log updated in `docs/integration/002_RELEASE_PROCESS.md` with FR-008/025/027/028 wiring and docs-sync details.
- 2026-02-20: **Runtime IPC command-arg casing fix pass implemented (workspace).** Frontend `services/backend.ts` now sends camelCase top-level invoke args expected by Tauri command parsing (`collectionId`, `pageId`, `taskId`, `tripId`, `startDate`, `endDate`, `projectId`, `itemId`, `editedJson`) and corresponding frontend smoke tests were updated. Backend week view query now accepts caller reference date for week windows (`calendar_get_week(start_date)` routed to `PageRepository::get_week_events(reference_date)`) with integration test coverage (`get_week_events_uses_reference_date_window`). UI reliability improvements added for Habits/Goals/Travel/WeekDashboard/Meals error surfacing and recipe-create flow.
- 2026-02-20: **Week planner/task editor/travel setup reliability pass implemented (workspace).** Frontend week view now supports drag-drop task scheduling with persisted refresh and an explicit event-detail save flow for date/time/location/description edits; task modal editing now uses local draft + explicit save to avoid per-keystroke persistence resets affecting TipTap/tags; Meals planner slot assignment now uses deterministic week-date mapping with in-context recipe creation flow; Travel new-trip flow now captures destination/date/duration/optional budget and derives itinerary days from trip metadata. Backend `travel_create_trip` now accepts optional `budget` and persists it into overview markdown + trip props. Contracts docs updated for `travel.createTrip budget?`; ADR-0016 added for future macro-tracking extension.
- 2026-02-20: **Frontend projects-board bug sweep merged + pinned.** Frontend PR `cortex-os-frontend#37` merged at `3039b12` (issues #27/#28/#30/#31/#32/#33/#34/#35): in-app project creation modal, project-filter diagnostics, functional master-task sort/group controls, and wired Projects-board task creation actions. Integration release log and traceability were updated alongside the submodule bump.
- 2026-02-20: **Task markdown/title persistence bug fixed and documented.** User-reported bug: TaskDetailModal edits appeared saved in-session but markdown/title did not persist to task cards after reload. Frontend fix shipped at `60daf9f`: `services/backend.ts` now sends task title via top-level `page_update_props.title` and persists markdown via `page_update_body` in the task update path; backend smoke regression coverage added. Integration docs updated (`docs/traceability.md`, `docs/integration/002_RELEASE_PROCESS.md`) and submodule pins refreshed.
- 2026-02-20: **ADR-0018 added (calendar platform evolution).** Proposed DayFlow integration with a centralized frontend calendar workspace that serves Day/Week/Month views, including continuous month navigation/scrolling, while preserving backend-owned Google OAuth/sync and two-way Cortex event reconciliation rules. FR-015 wording and traceability calendar notes were updated to reflect scope.
- 2026-02-20: **Integration pin sync for calendar hardening + ADR planning.** `cortex-os` now tracks backend `3680664`, frontend `a336452`, contracts `69b5609`; release log updated with calendar interaction hardening and ADR-0018 documentation sync.
- 2026-02-20: **ADR-0018 revised after upstream DayFlow source evaluation (`/Users/jdtarriela/proj/calendar`, `aca8f8f`).** Decision changed from direct migration to gated adoption with explicit checks for month virtualization performance, delta-based adapter sync, task/event drag semantics, Google mixed-permission policy, and a11y/keyboard/mobile parity. FR linkage expanded to include FR-017/FR-018.
- 2026-02-20: **ADR-0018 updated with DayFlow v3 boundary/plugin details.** Added explicit Preact core + React adapter content-slot boundary risks, mandatory plugin bootstrap (`@dayflow/plugin-drag`, `@dayflow/plugin-keyboard-shortcuts`), external HTML5 sidebar task-drop gate, and stronger mixed-editability requirement with upstream PR/fork path for per-event drag/resize permissions.
- 2026-02-20: **ADR-0018 risk reconciliation added.** Document now includes a risk-mitigation register (adapter complexity, Preact/React boundary, per-event permission model, upstream churn) with verification criteria and explicit fallback decisions.
- 2026-02-20: **ADR-0018 promoted to ACCEPTED and execution epics created.** GitHub epics opened in integration repo: `#23` (adapter foundation), `#24` (interaction parity/external drop), `#25` (mixed editability), `#26` (a11y/keyboard/responsive), `#27` (performance/upgrade governance).
- 2026-02-20: **Traceability plan updated for ADR-0018 execution.** `docs/traceability.md` now includes FR-row linkage updates (FR-001/015/017/018/027) and an explicit ADR-0018 Delivery Traceability table mapping epics -> FRs -> evidence targets.
- 2026-02-20: **ADR-0018 cross-repo child execution issues opened and linked.** Created 15 child issues across `cortex-os-frontend` (`#38-#42`), `cortex-os-backend` (`#29-#33`), and `cortex-os-contracts` (`#13-#17`) with detailed implementation instructions; parent epics `cortex-os#23-#27` now include child-checklist backlinks for bidirectional traceability.
- 2026-02-20: **ADR-0018 epic #23 completed (child execution closure).** Frontend child `cortex-os-frontend#38` closed at `9a213c5` (CalendarWorkspace hook, DayFlow adapter/plugin bootstrap, Week/Today controller wiring + tests). Backend child `cortex-os-backend#29` closed at `cd91dd7` (`calendar_get_range` command, storage range query, validation + integration tests). Contracts child `cortex-os-contracts#13` closed at `75f50e2` (IPC wiring matrix update, calendar range conventions/versioning/changelog sync). Parent epic `cortex-os#23` acceptance criteria were checked and closed with evidence links.
- 2026-02-20: **ADR-0018 E23 PR merge + integration pin sync complete.** Component PRs merged: `cortex-os-frontend#43` (`195e338`), `cortex-os-backend#34` (`9a4b77b`), `cortex-os-contracts#18` (`f28941b`). Integration repo submodules are pinned to these merged `main` SHAs; release log updated accordingly.
- 2026-02-20: **ADR-0018 epic #24 completed (E24 — Interaction Parity: External Task Drop + Drag/Resize).** Frontend child `cortex-os-frontend#39` closed at `f3a77f0`: `utils/calendarDropIntent.ts` maps DayFlow DOM `data-date`/time-grid offset to `DropIntent {date, allDay}`; `DayflowCalendarSurface.tsx` wires `onDrop` to `calendar.scheduleTask` (external drop) or `calendar.rescheduleEvent` (internal drag); `useDragDrop` updated with synchronous state and `dropEffect='copy'`; 143 tests green. Backend child `cortex-os-backend#30` closed at `b44f5d2`: `PageRepository::reschedule_event()` enforces read-only guard (FR-027); `calendar_schedule_task` and `calendar_reschedule_event` Tauri commands added; 4 TDD tests in `e24_drag_drop.rs`. Contracts child `cortex-os-contracts#14` closed at `ccff18e`: `calendar.scheduleTask` and `calendar.rescheduleEvent` rows + intent-mapping table added to IPC wiring matrix. Parent epic `cortex-os#24` closed. Submodules pinned: backend `b44f5d2`, frontend `f3a77f0`, contracts `ccff18e`.

- 2026-02-20: **ADR-0018 epic #24 frontend closure pass.** Frontend child `cortex-os-frontend#39` implemented externally mapped drag/drop via `calendarDropIntent` bounds checking against DayFlow DOM elements (`[data-date]` + `[data-timegrid="true"]`), preserving task/event update logic. Integration assertions added to `frontend/tests/calendar_sync.spec.ts` for task drop persistence correctness.
- 2026-02-20: **ADR-0018 epic #25 in review (E25 — Mixed Editability + Google Permission Enforcement).** Three PRs open: [contracts#20](https://github.com/jtarriela/cortex-os-contracts/pull/20) (`62717a3`): permission policy table + `readOnly` field + error semantics in IPC matrix. [backend#36](https://github.com/jtarriela/cortex-os-backend/pull/36) (`5db6632`): `is_read_only_event` helper, `update_calendar_event_props` + `delete_calendar_event` guarded storage methods, `calendar_event_is_editable` + `calendar_delete_event` IPC commands, 6 TDD tests in `e25_permissions.rs` (48 storage tests total). [frontend#45](https://github.com/jtarriela/cortex-os-frontend/pull/45) (`f2234f6`): `CalendarEvent.readOnly` field + adapter pipeline, `utils/calendarPermissions.ts` (`canEditEvent`/`canDeleteEvent`), pre-flight guards in all `useWeekDashboard` mutation paths (drag, resize, context-delete, DayFlow update/delete), `deleteCalendarEvent` routes through guarded command, visual state (opacity-60, cursor-not-allowed, tooltip), 10 new tests (153 total). ADR-0018 Gate 5 verification: per-event DayFlow drag/resize API unavailable upstream — guards applied at callback interception layer; no snap-back as steady-state UX. Pending SHA pin after merge.
- 2026-02-21: **ADR-0018 epic #27 implementation pass complete (E27 — Performance Benchmarks + Upgrade Governance) and moved to review.** Frontend child `cortex-os-frontend#42` now includes a reproducible DayFlow guardrail suite (`tests/perf/calendarMonthScroll.perf.test.ts`, `tests/calendar/dayflowAdapter.compat.spec.ts`, `tests/contracts/dayflowDependencyPolicy.spec.ts`) with CI step `npm run test:dayflow-guardrails`, plus upgrade checklist/PR template enforcement. Backend child `cortex-os-backend#33` adds migration `V4` calendar performance indexes (`idx_pages_calendar_kind_start_date`, `idx_pages_calendar_google_lookup`, `idx_pages_calendar_sync_source`), storage perf/query-plan harness (`crates/storage/tests/e27_performance.rs`), and bounded sync-run safeguards in `integrations_trigger_sync` with unit coverage (`enforce_sync_batch_limit_*`). Contracts child `cortex-os-contracts#17` adds calendar compatibility governance/checklists to `VERSIONING.md`, `CODEGEN.md`, and E27 notes in wiring matrix, with changelog version `0.6.1`. Integration traceability/ADR docs updated to reflect E27 in-review status; pending paired PR merge and SHA pin sync.
- 2026-02-21: **ADR-0018 epic #27 merged and pinned in integration repo.** Component PRs merged: `cortex-os-frontend#47` (`01e25af`), `cortex-os-backend#38` (`10c714b`), `cortex-os-contracts#22` (`821f2cc`). Integration release log/traceability/ADR gate statuses are now synchronized to completed, and the epic closure chain is complete: child issues `frontend#42`, `backend#33`, `contracts#17` and parent epic `cortex-os#27` closed.
- 2026-02-21: **`cal-patch` scheduling convergence pass moved to PR review.** Branch audit against `main` confirmed this is broader than a frontend-only bugfix. Frontend: Week planner now uses click-to-schedule modal UX (`ScheduleTaskModal`) via header button + DayFlow `+` interception; unscheduled sidebar drag entrypoint removed; `useWeekDashboard` uses `tasksRef`/`eventsRef` live refs and projects `calendarItems` as `googleEvents + scheduledTaskItems`; `services/normalization.ts` maps `task.start_time/end_time` into calendar DTOs. Backend: `calendar_schedule_task` and `calendar_add_from_task` now update task pages directly; `calendar_reschedule_event` handles both `task` and `calendar_event`; calendar reads (`today/week/range`) now include both kinds using `COALESCE(start,start_time)`. Contracts: wiring matrix calendar/E28 sections updated to reflect task-as-schedule semantics and modal-first scheduling flow. PRs opened: [frontend#48](https://github.com/jtarriela/cortex-os-frontend/pull/48), [backend#39](https://github.com/jtarriela/cortex-os-backend/pull/39), [contracts#23](https://github.com/jtarriela/cortex-os-contracts/pull/23), [integration#33](https://github.com/jtarriela/cortex-os/pull/33). Integration docs (`functional_requirements.md`, `traceability.md`) synchronized accordingly.
- 2026-02-21: **ADR-0019 proposed for Obsidian path-linking at scale.** Added `docs/adrs/ADR-0019-obsidian-linked-vault-by-path.md` with read-only-first linked-vault model, metadata-first sync schema (`vault_link`, `vault_file_manifest`, `vault_file_index_state`, `sync_queue`), and explicit RAG behavior: metadata checks determine changed files, ingest reads changed files only, and query-time RAG retrieves from DB indexes (no per-query filesystem reads).
- 2026-02-21: **Frontend AI Settings embedding selector added (UI phase) + ADR-0019 refined.** `frontend/views/Settings.tsx` now includes a RAG embeddings explainer panel and `embeddingProvider` selector (`same_as_model|openai|gemini|ollama|hash`) defaulting to same-as-active-model behavior. ADR-0019 updated with initial-link bounded parallel hashing/progress phases, include/exclude source selection, explicit hash-vs-embedding semantics, and embedding-provider policy defaults.
- 2026-02-22: **FR-027 Google mirror/full-history implementation pass (workspace) completed.** Backend: `IntegrationSettings` expanded with `editable_calendars` + migration marker; Google models/client now include rich metadata + all-day payload support; `integrations_google_calendars` returns metadata objects; `integrations_trigger_sync` emits `integrations_sync_progress`, removes 90-day floor, supports editable calendar mirrors (task + linked managed note + writable bridge props), and adds non-cortex mirror writeback path; new `integrations_delete_mirrored_event` command added. Frontend: `IntegrationSettings`/calendar metadata types updated, Settings now manages synced vs editable calendars by id with sync-status panel, new `useCalendarSyncQueue` (single-flight + 5-minute polling + progress listener), Week dashboard enqueues sync after edits and routes editable Google deletes to mirrored-delete command, month range prefetch added for seamless navigation in `useCalendarWorkspace`. Contracts/docs updated (`contracts/docs/technical_planning/002_IPC_WIRING_MATRIX.md`, `contracts/docs/VERSIONING.md`, integration FR/traceability/ADR docs). Verification: `npm test -- --run tests/hooks/useWeekDashboard.test.ts tests/hooks/useCalendarWorkspace.test.ts tests/calendar/dayflowAdapter.spec.ts tests/calendar/dayflowCalendarSurface.spec.ts tests/calendar/dayflowCalendarSync.spec.ts tests/settings_integrations.spec.tsx tests/calendar_sync.spec.ts` ✅, `cargo test -p google_calendar -p cortex-storage` ✅, `cargo test -p cortex-app --lib` ✅.
- 2026-02-22: **ADR-0019 coordinated delivery (workspace) completed.** Contracts now define `obsidian_link_add/list/remove/set_mode`, `obsidian_sync_now/status`, and `obsidian_sync_progress` with changelog/version `0.7.0`. Backend now includes linked-vault migration V5 tables (`vault_link`, `vault_file_manifest`, `vault_file_index_state`, `sync_queue`, `sync_runs`), repository/runtime modules, linked-note read-only mutation guards, and `AISettings.embedding_provider` roundtrip defaults. Frontend now includes linked-vault controller hook + integrations UI, `obsidian_*` gateway methods, linked-note normalization/read-only behavior, and Save-as-Cortex duplication flow. Verification: `cargo test -p cortex-storage` ✅, `cargo test -p cortex-app --lib` ✅, `npm test -- --run tests/hooks/useSettingsController.test.ts tests/settings_integrations.spec.tsx tests/notes_library.spec.tsx` ✅, `npm run build` ✅.
- 2026-02-22: **ADR-0019 component merges + integration pin sync complete.** Component repos fast-forwarded on `main`: backend `3eb7f8a`, frontend `918fe53`, contracts `189cf40`; integration release log row updated and submodule SHAs pinned to these merged commits.
- 2026-02-22: **ADR-0020 closure + ADR-0021 full PM/Gantt + visx standardization implemented in workspace release branch.** Frontend: added `useProjectsIndex` controller and moved ProjectsIndex data/menu/drag logic out of view (ADR-0017), added project/master-task context menus with overflow parity, implemented delete-unassign flow and project/status drag persistence, added `.cortex-editor ::selection` styling, introduced dual-write milestone utilities (`utils/projectMilestones.ts`) with marker sync (`<!-- milestone:{id} -->`), delivered timeline controller + visx Gantt (`useProjectTimeline.ts`, `components/projects/GanttChart.tsx`) with FS+lag cascade and client-side critical path, and migrated app charts from Recharts to visx with shared chart primitives + hooks (`useFinanceView`, `useGoalsView`, `useHabitsView`, `useJournalView`). Backend: added `col_project_milestones -> project_milestone` mapping + tests in `crates/core/src/lib.rs`. Contracts: updated wiring matrix for planning fields/milestone CRUD/dual-write policy and bumped docs version/changelog (`0.7.0`). Verification: `cd frontend && npm test` (52 files, 239 tests) ✅ and `cd backend && cargo test -p cortex-core` ✅.
- 2026-02-22: **ADR-0022 workspace implementation pass started (Vault Workbench + linked write-back).** Contracts expanded `VaultLink.mode` to `read_only|read_write` and added `obsidian.noteSave`/`LinkedNoteSaveResult` (`0.8.0`). Backend added `obsidian_note_save` with base-hash conflict responses, linked-path safety checks, raw markdown preservation for linked notes, and mode-aware write guards. Frontend replaced Notes center with tabbed Vault Workbench + CodeMirror source editor, added keyboard shortcuts (`Cmd/Ctrl+S`, `Cmd/Ctrl+W`, `Cmd/Ctrl+Shift+[`, `Cmd/Ctrl+Shift+]`, `Cmd/Ctrl+P`), and added conflict modal actions (use server / overwrite). Verification: `cd backend && cargo fmt --all && cargo test -p cortex-app --lib` ✅, `cd frontend && npm run lint && npm test` ✅.
- 2026-02-23: **ADR-0022 merged on component `main` branches and pinned in integration.** Component repos advanced to backend `650fe6b`, frontend `c6eeaff`, contracts `071038e`; integration docs updated (`FR-029`, ADR-0022, release log, traceability). Linked-vault commands/UI are now enabled by default with explicit opt-out (`CORTEX_ENABLE_OBSIDIAN_LINK=0` and UI feature toggle). Verification before pin: `cd backend && cargo fmt --all && cargo test -p cortex-app --lib` ✅, `cd frontend && npm run lint && npm test && npm run build` ✅.
- 2026-02-23: **Vault Workbench UX refinement + inspector follow-on implemented (ADR-0019/ADR-0022 scope).** Frontend now defaults Vault notes to rendered markdown preview with explicit source mode, split explorer sections into `Cortex Files` / `Obsidian Files`, and supports clickable Obsidian wikilink navigation with best-effort heading/block anchor scroll. Right drawer note focus now defaults to an `Inspect` tab (manual-open behavior retained) with frontmatter/outline/outgoing/backlinks/linked metadata/conflict diagnostics. Backend added `search_graph_links` (exact directed edges) and `obsidian_note_inspect` (linked-note manifest/index/sync metadata) IPCs; contracts matrix/changelog updated (`0.9.0`). Verification: `cd frontend && npm run lint && npm run build && npm run test -- --run && npm run test:perf` ✅; `cd backend && cargo test -p cortex-app --lib && cargo test -p cortex-storage linked_vault` ✅.
- 2026-02-23: **ADR-0023 YNAB finance integration implemented (workspace + submodules).** Backend added `backend/crates/app/src/ynab.rs` with YNAB PAT validation, local status, full/delta sync (`last_knowledge_of_server`), normalization into `ynab_*` page kinds, vault CSV mirror exports (`schema_manifest.json`, `sync_state.json`), tracked-category config persistence, and local whole-budget/tracked-category analytics; `crates/app/src/lib.rs` registers `finance_ynab_*` commands and `crates/core/src/lib.rs` adds `col_finance_ynab_*` collection mappings. Frontend Finance now uses real YNAB connect/sync/analyzer flows in `hooks/useFinanceView.ts` + `views/Finance.tsx`, with PAT onboarding, budget selection, sync actions, tracked-category configuration, and local YNAB transaction/month/category reads via `services/backend.ts`. Contracts updated with `finance.ynab*` wiring rows and `0.10.0` changelog entry. Verification: `cd backend && cargo check -p cortex-app -p cortex-core` ✅, `cd frontend && npm run lint` ✅, `cd frontend && npm test -- tests/hooks/useFinanceView.test.ts tests/backend.smoke.test.ts` ✅.
- 2026-02-23: **ADR-0024 finance UX split + manual budgeting UI implemented (frontend + integration docs + contracts docs alignment).** Frontend moved Finance mode selection to Settings → Life Modules (`financeMode` in app store), added app-level Settings tab targeting (`settingsTabTarget`) so Finance can redirect to Settings → Integrations, and moved YNAB PAT connect/disconnect UI into `views/Settings.tsx` while keeping sync/analyzer actions in `views/Finance.tsx`. Manual finance mode now loads the current `budget_month` page via existing `finance_get_budget`, saves category plans/cap via generic `page_update_props`, and renders a Notion-style current-month budget template with planned/actual/remaining/unallocated/utilization metrics derived from manual transactions/CSV imports. Added ADR-0024 and synchronized FR/traceability/contracts docs (`contracts` changelog `0.10.0`, finance wiring matrix frontend usage notes). Verification: `cd frontend && npm test -- tests/hooks/useFinanceView.test.ts tests/settings_integrations.spec.tsx` ✅, `cd frontend && npm test -- tests/backend.smoke.test.ts` ✅, `cd frontend && npm run lint` ✅.
- 2026-02-23: **Finance PR set merged + integration pin sync completed (rebased-on-main).** Component PRs merged with merge commits: `cortex-os-backend#40` (`122befb`), `cortex-os-frontend#49` (`f33b284`), `cortex-os-contracts#24` (`1db4aae`). GitHub Actions checks on backend/frontend PRs failed to start due account billing limits (not test regressions); local validation completed in workspace before merge (`cargo check`, frontend lint + targeted vitest). Integration submodule pointers were then pinned to merged `main` SHAs and release log/MEMORY updated in `cortex-os#34`.
- 2026-02-23: **Travel v2 staged integration planning docs added.** Added `docs/integration/005_TRAVEL_MODULE_INTEGRATION_PLAN.md` plus stage ADRs `ADR-0025` through `ADR-0031` covering Stage 1→6 implementation slices (foundation/RAG, itinerary+budget, maps+routing+Google export, imports incl. Gmail scan, AI planner, calendar push hardening).
- 2026-02-23: **Travel Stage 1/2 structured workspace slice implemented and merged to component `main` branches + integration pinned.** Backend added Travel v2 workspace/location/item/expense/budget/migration commands and RAG indexing parity for legacy travel creates; frontend added ADR-0017 `useTravelWorkspace` controller + structured Travel UI and budget flows; contracts added Travel v2 Stage 1-2 IPC rows. Integration `main` pinned to backend `aa1b51f`, frontend `276c959`, contracts `e34a55d` (`fcb6e87` superproject).
- 2026-02-23: **Travel Stage 1/2 integrity patch merged locally across workspace repos (pin sync ready in integration commit).** Component local `main` SHAs: backend `6012c79`, frontend `1f6b7d5`, contracts `123afae`. Patch fixes travel item create/move cross-trip corruption risks, adds travel kind guards + title-only markdown/body sync, makes legacy migration duplicate-safe (`legacy_card_id`), adds hybrid per-location item pathing for new location-scoped files, makes create-trip selection deterministic, updates contracts docs (`travel.moveItem clearLocation?`, `0.10.2`), and adds regression tests (`cargo test -p cortex-app travel_`, `frontend/tests/hooks/useTravelWorkspace.test.ts`).
- 2026-02-23: **ADR-0027 Stage 3 component PRs merged and integration pin/closure sync completed.** Component PRs merged: `cortex-os-contracts#26` (`c3165fb`), `cortex-os-backend#42` (`3dd6347`), `cortex-os-frontend#51` (`34095bd`); kickoff integration docs/ADR PR `cortex-os#36` merged earlier. Integration closure sync pins submodule SHAs, updates `docs/traceability.md` FR-008 for Stage 3 maps/routing/export + review-remediation coverage, updates `docs/integration/002_RELEASE_PROCESS.md` + `.system/MEMORY.md`, and marks ADR-0027 IMPLEMENTED.
- 2026-02-23: **Atomic Habits docs-first kickoff completed (Habits module expansion planning).** Rebased workspace branch `codex/rebase-main-finance-integration` onto latest `origin/main`, added `docs/implementation/ADR-0032-atomic-habits-implementation-plan.md`, and created `docs/adrs/ADR-0032-habits-atomic-system-weekly-review-calendar-sync.md` as **ACCEPTED** (ADR-0025 through ADR-0031 are already occupied by Travel v2 stage ADRs). Updated `docs/functional_requirements.md` (`FR-011`, `FR-015`, `FR-026`) for Atomic Habits + Weekly Review + habit-generated calendar block semantics, and added a planning-status note to `docs/traceability.md` `FR-011` while preserving current implementation evidence. Implementation remains pending paired PRs in `cortex-os-contracts`, `cortex-os-backend`, and `cortex-os-frontend`.
- 2026-02-23: **ADR-0032 local implementation pass completed across backend/frontend/contracts (pre-merge).** Backend adds dual-mode habit toggle semantics (`completion_type` standard/mvh with same-day mutual exclusivity), MVH-aware streak recompute and split summary metrics, `habits_sync_week_plan`, and linked habit-plan write-back on `calendar_reschedule_event` / `calendar_delete_event`. Frontend delivers Atomic Habits `ATOMS` UI, system designer modal, dual Standard/MVH completion actions, multi-state heatmaps, persisted Weekly Review + look-forward planner, and week-plan sync wiring. Contracts wiring matrix/changelog now document `habits.syncWeekPlan`, `habits.toggle` `completionType`, `habits.getSummary` split metrics, and calendar linked-habit semantics. Integration traceability updated and audit artifact added at `docs/implmentation/ADR-0032-implementation-audit.md`. Validation executed locally: `cargo check -p cortex-app`, targeted `cortex-storage` habit toggle tests, `frontend` targeted Vitest suites, and `frontend` build.
- 2026-02-23: **ADR-0032 component PRs merged; integration pin/docs branch refreshed for frontend rebase.** Component PRs merged with merge commits: `cortex-os-contracts#27` (`7d3b504`), `cortex-os-backend#43` (`a2c4852`), `cortex-os-frontend#52` (`3645010`, rebased before merge to resolve `services/backend.ts` conflict against Travel map mocks/types on `main`). Review-remediation fixes included in merged code: backend safe-fail parsing for malformed weekly review plan items (prevents orphan calendar-block deletion), frontend Weekly Review save/sync concurrency guard, and week-rollover review targeting refresh. Integration branch updates submodule pointers and release log prior to opening/merging the coordinated integration pin PR.
- 2026-02-23: **ADR-0032 Weekly Prep redesign follow-on implemented locally (pre-merge).** Habits Weekly Prep is now per-habit in frontend (`views/Habits.tsx`, `hooks/useHabitsView.ts`) with weekly prep snapshots (`habit_prep_items`) seeded from habit defaults, explicit "Save as Habit Default", and one-time legacy global checklist import marker (`prep_migrated_from_global_env_at`). Backend `habits_sync_week_plan` now projects per-habit prep snapshots onto generated `calendar_event` props (`habit_prep_environment_checklist_items`, `habit_prep_notes`, `habit_prep_week_start_date`) and preserves user-owned event props (notably `description`) on re-sync while keeping linked calendar write-back schedule/removal-only. Week event details UI surfaces read-only Habit Prep + editable Event Notes. Contracts wiring/changelog and integration ADR-0032/implementation-plan/FR-011/015/026/traceability docs synchronized. Paired component PRs/pins still pending (frontend/backend/contracts + integration pin PR after merges).
